<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何用Koa2返回文本和图片流以及解决乱码事件 | RJW&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/sl.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="你若盛开，蝴蝶自来">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.1c793696.css" as="style"><link rel="preload" href="/assets/js/app.69ab4a99.js" as="script"><link rel="preload" href="/assets/js/3.3b39e7a0.js" as="script"><link rel="preload" href="/assets/js/1.88acf310.js" as="script"><link rel="preload" href="/assets/js/9.97d634f1.js" as="script"><link rel="preload" href="/assets/js/12.9e8433f0.js" as="script"><link rel="prefetch" href="/assets/js/10.d62c995d.js"><link rel="prefetch" href="/assets/js/11.1384acab.js"><link rel="prefetch" href="/assets/js/13.c3dd678c.js"><link rel="prefetch" href="/assets/js/14.77235c73.js"><link rel="prefetch" href="/assets/js/15.9538787d.js"><link rel="prefetch" href="/assets/js/16.8917779f.js"><link rel="prefetch" href="/assets/js/17.4e25faa6.js"><link rel="prefetch" href="/assets/js/18.8d0e9663.js"><link rel="prefetch" href="/assets/js/19.0ef6d18e.js"><link rel="prefetch" href="/assets/js/20.f9f00376.js"><link rel="prefetch" href="/assets/js/21.0174c86d.js"><link rel="prefetch" href="/assets/js/22.bf304af6.js"><link rel="prefetch" href="/assets/js/23.67fbfbae.js"><link rel="prefetch" href="/assets/js/24.13491854.js"><link rel="prefetch" href="/assets/js/25.b91a31fa.js"><link rel="prefetch" href="/assets/js/26.d7c907d5.js"><link rel="prefetch" href="/assets/js/27.c4fd3e8f.js"><link rel="prefetch" href="/assets/js/28.3c811814.js"><link rel="prefetch" href="/assets/js/29.b0ecd0bd.js"><link rel="prefetch" href="/assets/js/30.4de5466b.js"><link rel="prefetch" href="/assets/js/31.8677ab92.js"><link rel="prefetch" href="/assets/js/4.078135db.js"><link rel="prefetch" href="/assets/js/5.8d61b07d.js"><link rel="prefetch" href="/assets/js/6.f943569e.js"><link rel="prefetch" href="/assets/js/7.85eba70b.js"><link rel="prefetch" href="/assets/js/8.c86ada2b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c793696.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>RJW's Blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>RJW</span>
            
          <span data-v-64685f0e>2017 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">RJW's Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/koa2/" class="nav-link"><i class="iconfont undefined"></i>
  koa2
</a></li><li class="dropdown-item"><!----> <a href="/categories/GraphQL/" class="nav-link"><i class="iconfont undefined"></i>
  GraphQL
</a></li><li class="dropdown-item"><!----> <a href="/categories/脚手架/" class="nav-link"><i class="iconfont undefined"></i>
  脚手架
</a></li><li class="dropdown-item"><!----> <a href="/categories/js基础/" class="nav-link"><i class="iconfont undefined"></i>
  js基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端工具/" class="nav-link"><i class="iconfont undefined"></i>
  前端工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/css/" class="nav-link"><i class="iconfont undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/categories/react-native/" class="nav-link"><i class="iconfont undefined"></i>
  react-native
</a></li><li class="dropdown-item"><!----> <a href="/categories/性能优化/" class="nav-link"><i class="iconfont undefined"></i>
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/categories/重构/" class="nav-link"><i class="iconfont undefined"></i>
  重构
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack/" class="nav-link"><i class="iconfont undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue源码/" class="nav-link"><i class="iconfont undefined"></i>
  vue源码
</a></li><li class="dropdown-item"><!----> <a href="/categories/tool/" class="nav-link"><i class="iconfont undefined"></i>
  tool
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="http://shooterblog.site/Notebook/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  📝 个人笔记本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/shooterRao" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><img src="https://avatars1.githubusercontent.com/u/23609695?s=400&amp;u=d2db8f6efdee5add420addf7f89b916f7ef47ca7&amp;v=4" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    RJW
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>19</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>24</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/koa2/" class="nav-link"><i class="iconfont undefined"></i>
  koa2
</a></li><li class="dropdown-item"><!----> <a href="/categories/GraphQL/" class="nav-link"><i class="iconfont undefined"></i>
  GraphQL
</a></li><li class="dropdown-item"><!----> <a href="/categories/脚手架/" class="nav-link"><i class="iconfont undefined"></i>
  脚手架
</a></li><li class="dropdown-item"><!----> <a href="/categories/js基础/" class="nav-link"><i class="iconfont undefined"></i>
  js基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端工具/" class="nav-link"><i class="iconfont undefined"></i>
  前端工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/css/" class="nav-link"><i class="iconfont undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/categories/react-native/" class="nav-link"><i class="iconfont undefined"></i>
  react-native
</a></li><li class="dropdown-item"><!----> <a href="/categories/性能优化/" class="nav-link"><i class="iconfont undefined"></i>
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/categories/重构/" class="nav-link"><i class="iconfont undefined"></i>
  重构
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack/" class="nav-link"><i class="iconfont undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue源码/" class="nav-link"><i class="iconfont undefined"></i>
  vue源码
</a></li><li class="dropdown-item"><!----> <a href="/categories/tool/" class="nav-link"><i class="iconfont undefined"></i>
  tool
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="http://shooterblog.site/Notebook/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  📝 个人笔记本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/shooterRao" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>如何用Koa2返回文本和图片流以及解决乱码事件</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>RJW</span>
            
          <span data-v-64685f0e>2017 - </span>
          2022
        </a></span></div></div> <div data-v-2d5f533b><main class="page"><div class="page-title" style="display:none;"><h1 class="title">如何用Koa2返回文本和图片流以及解决乱码事件</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>RJW</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2018-04-15</span></i> <!----> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>js</span><span class="tag-item" data-v-3b7f5bdf>node</span><span class="tag-item" data-v-3b7f5bdf>koa2</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>前两天做项目的时候，碰到了一个要在客户端(浏览器)中实现预览 txt 文档和图片的小需求，在开发过程中遇到了一些有趣的小插曲---客户端读取 txt 时出现各种奇怪乱码，图片就没问题。一时半会还没找到好的解决方法，因为那天又刚好周五，所以在周末的时候，我决定宅在家里好好研究如何解决这个有趣的现象。</p> <h2 id="先用-koa2-搭建后台环境-并返回流"><a href="#先用-koa2-搭建后台环境-并返回流" class="header-anchor">#</a> 先用 Koa2 搭建后台环境,并返回流</h2> <p>由于公司用的是基于 java 的后台环境，我电脑上没有搭好这些 java 框架的环境，于是我就用 Koa2(基于 Node.js 的一个框架)搭建好后台环境，先实现给客户端返回流。</p> <h3 id="如何搭建-koa2-环境"><a href="#如何搭建-koa2-环境" class="header-anchor">#</a> 如何搭建 Koa2 环境？</h3> <p>搭建 koa2 非常简单，先在一个新目录下，用<code>npm init --y</code>快递初始化<code>package.json</code>，然后用<code>npm</code>或者<code>yarn</code>装好 koa 的包</p> <blockquote><p>npm install koa --save 或者 yarn add koa</p></blockquote> <p>新建一个<code>app.js</code>，在里面敲下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server is listening at 3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>接着你只需要用<code>node app</code>命令就可以在 3000 端口上启动一个服务器啦~</p> <h3 id="如何用-koa2-返回流"><a href="#如何用-koa2-返回流" class="header-anchor">#</a> 如何用 Koa2 返回流？</h3> <p>比如，我希望是这样的，客户端请求<code>http://localhost:3000/img?imgName=图片名.jpg</code>这个 url 时，会返回图片的流，用<code>http://localhost:3000/text?fileName=文档名.txt</code>这个 url 时，会返回文本的流。那么，该如何实现呢？来，上代码讲解</p> <p>先安装<code>koa-router</code></p> <blockquote><p>npm install koa-router --save</p></blockquote> <h4 id="先实现图片流返回"><a href="#先实现图片流返回" class="header-anchor">#</a> 先实现图片流返回</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//引入koa-router包</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-router&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 引入fs文件系统</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 先实现返回图片流(buffer)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/img&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> imgName <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query<span class="token punctuation">;</span> <span class="token comment">// 提取参数</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readImg</span><span class="token punctuation">(</span>imgName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// res 为 Buffer流</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;jpg&quot;</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 用fs处理流</span>
<span class="token keyword">function</span> <span class="token function">readImg</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建可读流</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> readerStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./public/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readerStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    readerStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> finalData <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 合并Buffer</span>
      <span class="token function">res</span><span class="token punctuation">(</span>finalData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>如果对上面代码有疑惑，建议先学习<code>ES7</code>的<code>async await</code>语法，再去读读 Koa2 的官方文档，有关<code>async await</code>的知识我到时会写一篇博客来讲解。</p> <blockquote><p>关于<code>async await</code>的学习可以<a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="noopener noreferrer">点这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <blockquote><p>Koa2 官网文档<a href="https://koa.bootcss.com/" target="_blank" rel="noopener noreferrer">点这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h4 id="再来实现文档流返回"><a href="#再来实现文档流返回" class="header-anchor">#</a> 再来实现文档流返回</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/text&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> fileName <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query<span class="token punctuation">;</span> <span class="token comment">// 提取参数</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readTXT</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">readTXT</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建可读流</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> readerStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./public/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readerStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 读完后promise返回</span>
    readerStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> finalData <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">res</span><span class="token punctuation">(</span>finalData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    readerStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">rej</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>接着，重要的不要忘处理跨域，应该客户端是在其他端口打开的</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 处理跨域</span>
router<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&quot;/*&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// *代表允许来自所有域名请求</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 其他一些设置...</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// use router</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 最后启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server is listening at 3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>于是后端环境就搭建好了，下面来说说客户端怎么写测试</p> <h3 id="客户端写个测试测测"><a href="#客户端写个测试测测" class="header-anchor">#</a> 客户端写个测试测测</h3> <p>核心代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 简单封装ajax</span>
<span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&quot;blob&quot;</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> blob <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// get请求添加查询参数</span>
<span class="token keyword">function</span> <span class="token function">urlParam</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  url <span class="token operator">+=</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;?&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
  url <span class="token operator">+=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> url<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 点击获取图片，并渲染到页面上</span>
reqImg<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">urlParam</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000/img&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;imgName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;duang.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> blob <span class="token operator">=</span> response<span class="token punctuation">;</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 点击获取txt,并渲染</span>
reqTxt<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">urlParam</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000/text&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fileName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> response<span class="token punctuation">;</span>
    <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> pre <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;pre&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pre<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>好了，测试看看</p> <p><img src="/assets/img/test1.4328192a.png" alt="测试结果"></p> <p>恩，到这就已经实现服务端可以返回流，客户端请求并渲染了。</p> <h2 id="说说遇到的小插曲-重点"><a href="#说说遇到的小插曲-重点" class="header-anchor">#</a> 说说遇到的小插曲（重点）</h2> <p>在前天开发的时候，后端给我传回了文本流，我这边也拿到了，不过在渲染时出现了很多乱七八糟的码，看得我头皮发麻。。。然后经过沟通发现，发现客户上传的 txt 不是<code>utf-8</code>编码的，是<code>ANSI</code>这种编码格式。接着，后端大佬问我能不能在客户端通过 js 来渲染<code>ANSI</code>格式的 txt 文档，因为后台转码可以会带来性能的一些问题。为了能解决这个问题，经过我周末的仔细研究和反复测试，发现问题不算很复杂，主要涉及到了一些关于编码方面的知识。</p> <h3 id="开始研究"><a href="#开始研究" class="header-anchor">#</a> 开始研究</h3> <p>首先，我试着保存一个<code>ANSI</code>编码的 txt 文本</p> <p><img src="data:image/png;base64,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" alt="保存ANSI"></p> <p>然后通过服务端返回流，看看客户端会不会出现乱码
服务端代码不改，只改了客户端请求的文件，文件名为<code>ANSI</code>格式的 txt</p> <p>结果</p> <p><img src="data:image/png;base64,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" alt="测试结果"></p> <p>果不奇然，跟前天一样，乱码！出了一堆 ��� 的玩意！</p> <p>怎么才能把这些神奇的字符翻译过来呢，于是，我就想有什么 api 可以，经过我一番查找，发现<code>FileReader的api readAsText(data, encoding)</code>第二个参数貌似可以翻译过来！突然有点小鸡冻，二话不说，赶紧试了下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&quot;ANSI&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>刷新浏览器，点了下测试 button，结果...</p> <p><img src="data:image/png;base64,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" alt="测试结果"></p> <p>还是一样啊！！！难道<code>readAsText</code>不支持<code>ANSI</code>这种编码格式吗？？？</p> <p><img src="/assets/img/zk.803a0c1a.jpg" alt="duang"></p> <h3 id="ansi-是什么"><a href="#ansi-是什么" class="header-anchor">#</a> ANSI 是什么？</h3> <p>我在想，<code>ANSI</code>到底是一种什么样的编码，为什么不能转，于是通过搜索引擎去查查看，发现</p> <blockquote><p>不同的国家和地区制定了不同的标准，由此产生了 GB2312、GBK、Big5、Shift_JIS 等各自的编码标准。这些使用 1 至 4 个字节来代表一个字符的各种汉字延伸编码方式，称为 ANSI 编码。在简体中文 Windows 操作系统中，ANSI 编码代表 GBK(GB2312) 编码；在日文 Windows 操作系统中，ANSI 编码代表 Shift_JIS 编码。</p></blockquote> <p>这么说，<code>ANSI</code>只是一种假象？？？</p> <p>接着 google 继续找</p> <p><img src="data:image/png;base64,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" alt="老外说ANCI是个bad joke"></p> <p>看完了一圈下来，我终于明白了，原来根本就没有<strong>ANSI</strong>这种编码！只是一种泛型！在不同的 Windows 版本里，<code>ANSI</code>是<code>gbk</code>或者<code>gb2312</code>编码，在日文中，为<code>Shift_JIS</code>编码，在繁体中文中，为<code>big5</code>编码。</p> <p>于是，我用<code>nodepad++</code>打开<code>anci.txt</code>发现</p> <p><img src="data:image/png;base64,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" alt="gb2312"></p> <p>果然是<strong>gb2312</strong>编码！！！<strong>所以，用 UTF-8(网页默认)去读 gb2312 编码文档是会出现乱码情况的</strong>。</p> <p>so，换个角度，我是不是通过这么修改达到我的目的呢？</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&quot;gb2312&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>感觉是可以的，突然又有了一点小鸡冻！！！试试看~</p> <p>duang~</p> <p><img src="data:image/png;base64,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" alt="测试结果"></p> <p>结果能正常显示了！！！Yeah~</p> <h2 id="结论"><a href="#结论" class="header-anchor">#</a> 结论</h2> <blockquote><p>事实上，所谓的「ANSI」指的是对应当前系统 locale 的遗留（legacy）编码。不要用记事本，用专业的文本编辑器保存为不带 BOM 的 UTF-8。(知乎大 V)</p></blockquote> <p>记得有位前辈说过，文档最好不要用记事本保存，用 nodepad++最好，以免出现无法预测的错误。到了今天我才知道，原来，那位前辈说的话恰好印证了上面某知乎大 V 说的，尽量不要用记事本保存。但是，毕竟客户不是搞开发的，他们也不知道这样编码的玩意，他们百分之 99.999%都是用记事本打开保存文档，然后上传，所以，在以后开发中，若是再出现这种情况，应该跟后端沟通好，如果是 gb2312 编码格式的 txt，就返回字段告诉前端，用<code>reader.readAsText(data, &quot;gb2312&quot;)</code>去读写文档，避免出现乱码的尴尬现象。</p> <p>最后附上 demo 的 github 地址: https://github.com/shooterRao/node-demo/tree/master/koa2-stream</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/11/17 10:04:04</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----></div></div>
    <script src="/assets/js/app.69ab4a99.js" defer></script><script src="/assets/js/3.3b39e7a0.js" defer></script><script src="/assets/js/1.88acf310.js" defer></script><script src="/assets/js/9.97d634f1.js" defer></script><script src="/assets/js/12.9e8433f0.js" defer></script>
  </body>
</html>
