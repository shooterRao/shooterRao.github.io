<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="è®°ä¸€æ¬¡ç³»ç»Ÿå‰ç«¯åº•å±‚å‡çº§æ€»ç»“"><meta name="keywords" content="é‡æ„,vue"><meta name="author" content="Rao Jinwei,undefined"><meta name="copyright" content="Rao Jinwei"><title>è®°ä¸€æ¬¡ç³»ç»Ÿå‰ç«¯åº•å±‚å‡çº§æ€»ç»“ | Rao Jinwei's Blog</title><link rel="shortcut icon" href="/sl.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.4.2"><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  localSearch: undefined
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="åˆ‡æ¢æ–‡ç« è¯¦æƒ…">åˆ‡æ¢ç«™ç‚¹æ¦‚è§ˆ</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…³äºè¿™æ¬¡å‡çº§"><span class="toc-number">2.</span> <span class="toc-text">å…³äºè¿™æ¬¡å‡çº§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…³äºvuecli3"><span class="toc-number">3.</span> <span class="toc-text">å…³äºvuecli3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®¹å™¨å¸ƒå±€ç»„ä»¶é‡å†™"><span class="toc-number">4.</span> <span class="toc-text">å®¹å™¨å¸ƒå±€ç»„ä»¶é‡å†™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç³»ç»Ÿèœå•æ”¹ä¸ºæ ¹æ®è·¯ç”±è¡¨ä¿¡æ¯è¿›è¡Œæ¸²æŸ“"><span class="toc-number">5.</span> <span class="toc-text">ç³»ç»Ÿèœå•æ”¹ä¸ºæ ¹æ®è·¯ç”±è¡¨ä¿¡æ¯è¿›è¡Œæ¸²æŸ“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è·¯ç”±è¡¨æŒ‰ç³»ç»Ÿåˆ’åˆ†è¿›è¡Œé‡æ„"><span class="toc-number">6.</span> <span class="toc-text">è·¯ç”±è¡¨æŒ‰ç³»ç»Ÿåˆ’åˆ†è¿›è¡Œé‡æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç›®å½•ç»“æ„é‡æ–°æ•´ç†"><span class="toc-number">7.</span> <span class="toc-text">ç›®å½•ç»“æ„é‡æ–°æ•´ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pre-commit"><span class="toc-number">8.</span> <span class="toc-text">pre-commit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sass-å‡½æ•°ç¼–å†™"><span class="toc-number">9.</span> <span class="toc-text">sass å‡½æ•°ç¼–å†™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é¦–å±ä¼˜åŒ–"><span class="toc-number">10.</span> <span class="toc-text">é¦–å±ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…¼å®¹IE11"><span class="toc-number">11.</span> <span class="toc-text">å…¼å®¹IE11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è‡ªåŠ¨æ³¨å†Œå…¨å±€ç»„ä»¶"><span class="toc-number">12.</span> <span class="toc-text">è‡ªåŠ¨æ³¨å†Œå…¨å±€ç»„ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹"><span class="toc-number">13.</span> <span class="toc-text">ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æƒé™æ§åˆ¶"><span class="toc-number">14.</span> <span class="toc-text">æƒé™æ§åˆ¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å•å…ƒæµ‹è¯•"><span class="toc-number">15.</span> <span class="toc-text">å•å…ƒæµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è‡ªåŠ¨åŒ–éƒ¨ç½²"><span class="toc-number">16.</span> <span class="toc-text">è‡ªåŠ¨åŒ–éƒ¨ç½²</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">17.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars1.githubusercontent.com/u/23609695?s=400&amp;u=d2db8f6efdee5add420addf7f89b916f7ef47ca7&amp;v=4"></div><div class="author-info__name text-center">Rao Jinwei</div><div class="author-info__description text-center">è¿½å¯»ç”Ÿæ´»çš„å½±å­</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">æ–‡ç« </span><span class="pull-right">16</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">æ ‡ç­¾</span><span class="pull-right">18</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">åˆ†ç±»</span><span class="pull-right">11</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://pic1.win4000.com/wallpaper/7/59bb35a6c903f.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Rao Jinwei's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">è®°ä¸€æ¬¡ç³»ç»Ÿå‰ç«¯åº•å±‚å‡çº§æ€»ç»“</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-11</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/vue/">vue</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘å‚ä¸äº†ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç±»åå°ç®¡ç†ç³»ç»Ÿçš„å‰ç«¯å¼€å‘(vueæŠ€æœ¯æ ˆ)ï¼Œå¹¶è´Ÿè´£äº†è¯¥ç³»ç»Ÿçš„åº•å±‚å‡çº§ï¼Œå‡çº§è¿‡ç¨‹æœŸé—´ï¼Œé‡åˆ°äº†ä¸å°‘é—®é¢˜ï¼Œåœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­å­¦åˆ°äº†å¾ˆå¤šï¼Œè¶ç€ä»Šå¤©åŒ11æ²¡å•¥äº‹åšğŸ™‚ï¼Œé‚£ä¹ˆå°±èŠ±ç‚¹æ—¶é—´æ€»ç»“ä¸‹å‡çº§ç³»ç»Ÿçš„è¿‡ç¨‹å§</p>
<a id="more"></a>
<h2 id="å…³äºè¿™æ¬¡å‡çº§"><a href="#å…³äºè¿™æ¬¡å‡çº§" class="headerlink" title="å…³äºè¿™æ¬¡å‡çº§"></a>å…³äºè¿™æ¬¡å‡çº§</h2><p>å¬åŒäº‹è¯´ï¼Œå½“æ—¶æ—¶é—´æ¯”è¾ƒæ€¥ï¼Œå¯¹<code>vuecli3</code>ä¸å¤ªç†Ÿæ‚‰ï¼Œå°±é€‰äº†åŸºäº<code>vuecli2</code>è¿›è¡Œå¿«é€Ÿå¼€å‘ã€‚å› ä¸ºæœ‰<strong>6</strong>ä¸ªç³»ç»Ÿï¼Œé¡µé¢éå¸¸å¤šï¼Œæ‰€ä»¥åœ¨åº•å±‚ä»£ç çš„ä¸Šæ²¡æœ‰å¤ªå¤šçš„æ—¶é—´è¿›è¡Œä¼˜åŒ–ã€‚åœ¨æˆ‘å‚ä¸è¿›æ¥ä¹‹åï¼Œæˆ‘æ”¶åˆ°äº†ä¸€äº›åŒäº‹çš„åé¦ˆå’Œè¿˜æ²¡æœ‰è§£å†³çš„é—®é¢˜ï¼Œæ¯”å¦‚é¦–å±åŠ è½½æ…¢ï¼Œè·¯ç”±è®¾è®¡å­˜åœ¨é—®é¢˜ï¼Œåˆ·æ–°é¡µé¢èœå•æ— æ³•é«˜äº®ç­‰ç­‰ã€‚è·Ÿå¼€å‘çš„å°ä¼™ä¼´å’Œé¢†å¯¼æ²Ÿé€šä¸€ç•ªä¹‹åï¼Œä»–ä»¬å†³å®šè®©æˆ‘å»è´Ÿè´£è§£å†³å½“å‰çš„è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥å½“æ—¶å‹åŠ›ä¹Ÿæ˜¯æœ‰ç‚¹å¤§çš„ã€‚æˆ‘æƒ³äº†ä¸‹ï¼Œæ—¢ç„¶è¦å‡çº§ï¼Œé‚£å°±æŠŠæˆ‘ä¹‹å‰ç ”ç©¶å‡ºæ¥çš„æˆæœéƒ½ä¸€å¹¶ç”¨ä¸Šï¼Œç„¶åé€æ­¥è§£å†³ã€‚æˆ‘é‡æ–°èµ·äº†ä¸€ä¸ªå‰¯æœ¬ï¼Œä»0ï¸âƒ£æ­å»ºç¯å¢ƒï¼Œå¼€å§‹äº†è¿™æ®µå‡çº§æ—…ç¨‹ğŸ‘Š</p>
<p>ä¸‹é¢æ˜¯å…³äºè¿™æ¬¡å‡çº§çš„featureï¼š</p>
<ul>
<li>åŸºäºvuecli3</li>
<li>layoutå±‚æŠ½è±¡ï¼Œå®ç°å­ç³»ç»Ÿé—´çµæ´»åˆ‡æ¢</li>
<li>è·¯ç”±è¡¨æŒ‰å­ç³»ç»Ÿæ¨¡å—è¿›è¡Œåˆ’åˆ†æ³¨å†Œ</li>
<li>å­ç³»ç»Ÿæ ¹æ®è·¯ç”±è¡¨ä¿¡æ¯æ¸²æŸ“ï¼Œå®ç°åŠ¨æ€å¯é…ç½®</li>
<li>ç›®å½•ç»“æ„é‡æ–°æ•´ç†ï¼Œä»£ç è§„èŒƒçº¦æŸ</li>
<li>ç»Ÿä¸€ç®¡ç†apiè¯·æ±‚å’Œå“åº”çš„æ‹¦æˆªï¼Œå¹¶è§„èŒƒå¥½apiè¯·æ±‚æ–¹å¼</li>
<li>å…¨å±€ç»„ä»¶è§„èŒƒç®¡ç†ï¼Œé¿å…é‡å¤é€ è½®å­</li>
<li>å…¨å±€ç»„ä»¶ã€æŒ‡ä»¤ã€vuex-moduleè‡ªåŠ¨åŒ–æ³¨å†Œ</li>
<li>sasså˜é‡åŠå‡½æ•°æ³¨å…¥ï¼Œå¸ƒå±€ä½¿ç”¨remæ–¹å¼</li>
<li>jest å•å…ƒæµ‹è¯•</li>
<li>jenkins+dockerè‡ªåŠ¨åŒ–æ‰“åŒ…éƒ¨ç½²</li>
<li>é¦–å±ä¼˜åŒ–ã€å…¼å®¹IE11</li>
</ul>
<p>ğŸ‘‡å¼€å§‹åˆ†ç‚¹è¿›è¡Œæ€»ç»“</p>
<h2 id="å…³äºvuecli3"><a href="#å…³äºvuecli3" class="headerlink" title="å…³äºvuecli3"></a>å…³äºvuecli3</h2><p>åœ¨ä¸Šä¸¤ä¸ªæœˆï¼Œvueå®˜æ–¹æ¨å‡ºäº†vuecli3çš„<code>release</code>ç‰ˆã€‚è·Ÿä»¥å¾€ç†Ÿæ‚‰çš„cli2ç›¸æ¯”ï¼Œcli3ç”Ÿæˆçš„é¡¹ç›®ç¡®å®å˜äº†ä¸å°‘ã€‚é¦–å…ˆå®˜æ–¹å¼€å§‹æ¨å´‡æ— <code>Eject</code>åŒ–ï¼Œå…³äºwebpackçš„ç›¸å…³é…ç½®å…¨éƒ¨éšè—ï¼Œåªæä¾›<code>vue.config.js</code>æ¥å£è¿›è¡Œç›¸å…³é…ç½®çš„æ›´æ”¹ã€‚è¿™æ ·ï¼Œå¯¹äºä¸æ€ä¹ˆéœ€è¦æ›´æ”¹webpacké…ç½®çš„å¼€å‘è€…æ¥è¯´ï¼Œå¯ä»¥æŠŠæ³¨æ„åŠ›éƒ½æ”¾åœ¨ä¸šåŠ¡å±‚ä¸Šï¼Œæ— é¡»è¿‡å¤šå…³å¿ƒåº•å±‚æ’ä»¶çš„é…ç½®ä¿¡æ¯ã€‚ä½†æ˜¯å¯¹äºè¦å¤§é‡ä¿®æ”¹webpacké…ç½®çš„å¼€å‘è€…æ¥è¯´ï¼Œéœ€è¦å­¦ä¹ <code>webpack-chain</code>çš„ä½¿ç”¨ï¼Œæ‰èƒ½å‡†ç¡®å¾—æ›´æ”¹webpackçš„é…ç½®ä¿¡æ¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œvuecli3å¯¹ä¸€äº›ç”Ÿæ€å’Œä¾èµ–éƒ½è¿›è¡Œäº†å…¨é¢çš„å‡çº§ï¼Œæ¯”å¦‚<code>Bebel7</code>,<code>webpack</code>å‡çº§åˆ°äº†4.xï¼Œä»£ç ç¼–è¯‘ä¼˜åŒ–ï¼Œæ‰“åŒ…é€Ÿåº¦éƒ½æœ‰äº†ç›¸å…³æå‡ã€‚</p>
<p>å…¶å®ï¼Œå¯¹äºæˆ‘ä»¬è¿™ç›®å‰çš„é¡¹ç›®æ¥è¯´ï¼Œä»cli2è¿ç§»åˆ°cli3çš„æˆæœ¬å¹¶ä¸å¤§ï¼Œåº•å±‚webpackçš„é…ç½®ä¿®æ”¹å¾—å¹¶ä¸å¤šï¼Œcli2èƒ½é…çš„cli3åŒæ ·èƒ½é…ï¼Œåªæ˜¯é…çš„æ–¹æ³•ç¨æœ‰ä¸åŒã€‚ä¸Šå±‚çš„é¡µé¢éƒ½å¯ä»¥æ— ç¼è¿›è¡Œè¿ç§»ã€‚å¯¹äº<strong>cli2ç‰ˆå¢åŠ çš„webpacké…ç½®</strong>ï¼Œæœ‰ä»¥ä¸‹å‡ é¡¹ï¼š</p>
<ul>
<li><code>sass-resources-loader</code>æ³¨å…¥å…¨å±€scsså˜é‡</li>
<li>ç”Ÿäº§ç¯å¢ƒå‰”é™¤<code>console.log</code></li>
<li>æ‰“åŒ…æ–‡ä»¶å‡ºå£è·¯å¾„ä¿®æ”¹</li>
</ul>
<p><code>cli3</code>å®ç°ä»¥ä¸Šå‡ ç‚¹çš„æ–¹æ³•ï¼š </p>
<ul>
<li>æ³¨å…¥å…¨å±€scsså˜é‡çš„æ–¹å¼:</li>
</ul>
<p>åœ¨<code>vue.config.js</code>ä¸­å¢åŠ ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  css: &#123;</div><div class="line">    loaderOptions: &#123;</div><div class="line">      <span class="comment">// ç»™ sass-loader ä¼ é€’é€‰é¡¹</span></div><div class="line">      sass: &#123;</div><div class="line">        data: <span class="string">`@import "@/styles/mixin.scss";`</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒå‰”é™¤<code>console.log</code></li>
</ul>
<p>åŒæ ·åœ¨<code>vue.config.js</code>ä¸­å¢åŠ ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å¼•å…¥uglifyjsæ’ä»¶</span></div><div class="line"><span class="keyword">const</span> UglifyJsPlugin = <span class="built_in">require</span>(<span class="string">"uglifyjs-webpack-plugin"</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  configureWebpack: &#123;</div><div class="line">    optimization: &#123;</div><div class="line">      minimizer: [</div><div class="line">        <span class="keyword">new</span> UglifyJsPlugin(&#123;</div><div class="line">          uglifyOptions: &#123;</div><div class="line">            compress: &#123;</div><div class="line">              warnings: <span class="literal">false</span>,</div><div class="line">              drop_console: <span class="literal">true</span>,</div><div class="line">              drop_debugger: <span class="literal">true</span></div><div class="line">            &#125;</div><div class="line">          &#125;,</div><div class="line">          parallel: <span class="literal">true</span>, <span class="comment">// å¹¶è¡Œå‹ç¼©</span></div><div class="line">        &#125;)</div><div class="line">      ]</div><div class="line">    &#125;,</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>æ‰“åŒ…æ–‡ä»¶å‡ºå£è·¯å¾„ä¿®æ”¹</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  baseUrl: process.env.NODE_ENV === <span class="string">"development"</span> ? <span class="string">"/"</span> : <span class="string">"./"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="å®¹å™¨å¸ƒå±€ç»„ä»¶é‡å†™"><a href="#å®¹å™¨å¸ƒå±€ç»„ä»¶é‡å†™" class="headerlink" title="å®¹å™¨å¸ƒå±€ç»„ä»¶é‡å†™"></a>å®¹å™¨å¸ƒå±€ç»„ä»¶é‡å†™</h2><p>å…³äºç³»ç»Ÿçš„å¸ƒå±€æ–¹å¼ï¼Œæˆ‘ç®€å•ç”»äº†ä¸‹ï¼š</p>
<p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/blog01.png" alt="Layout"></p>
<p>ä¹‹å‰åŸºäºcli2çš„ç‰ˆæœ¬ï¼Œæ˜¯æŠŠ<strong>ç³»ç»Ÿå†…å®¹</strong>ç”¨<code>&lt;router-view/&gt;</code>è¿›è¡Œç®¡ç†ï¼Œè“è‰²åœˆä¸­çš„åœ°æ–¹åˆåŒ…äº†ä¸€å±‚<code>&lt;router-view/&gt;</code>ï¼Œå¤–é¢çš„è·¯ç”±é‡‡ç”¨åŠ¨æ€è·¯ç”±å»ç®¡ç†ï¼š </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  name: <span class="string">"System"</span>,</div><div class="line">  path: <span class="string">"/System/:id"</span>,</div><div class="line">  props: <span class="literal">true</span>,</div><div class="line">  component: System</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹åº”ç³»ç»Ÿé¡µé¢çš„url<code>http://localhost:8080/#/System/0/FZBZDataview</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">id: 0 =&gt; ç³»ç»Ÿ1</div><div class="line">id: 1 =&gt; ç³»ç»Ÿ2</div><div class="line">id: 2 =&gt; ç³»ç»Ÿ3</div><div class="line">...</div></pre></td></tr></table></figure>
<p>è¿™ç§è®¾è®¡æœ‰ä¸ª<strong>é—®é¢˜</strong>ï¼Œå°±æ˜¯åœ¨vueåŠ¨æ€è·¯ç”±ä¸­ï¼Œ<code>/System/:id</code>ä¸­çš„<code>id</code>å¯ä»¥æ˜¯ä»»ä½•å€¼ï¼Œå¦‚æœä¸è¿›è¡Œåˆ¤æ–­éªŒè¯é€»è¾‘çš„è¯ï¼Œ<code>http://localhost:8080/#/System/xxx/FZBZDataview</code>éƒ½ä¼šè·³è½¬åˆ°è¯¥ç³»ç»Ÿé¡µé¢ï¼Œ<strong>å¹¶ä¸èƒ½è·³è½¬åˆ°æ­¤æ—¶åº”è¯¥è·³è½¬åˆ°çš„404é¡µé¢</strong></p>
<p>è¿˜æœ‰ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯åœ¨èœå•é«˜äº®çš„å¤„ç†ä¸Šï¼Œç”±äºåœ¨ä¸Šé¢è®¾è®¡çš„åŸºç¡€ä¸Šï¼Œé¢å¤–åŠ äº†å¾ˆå¤šçŠ¶æ€è¿›è¡Œç®¡ç†ï¼Œå¯¼è‡´å®ç°èœå•é«˜äº®æ–¹å¼è¿‡äºå¤æ‚äº†ï¼Œäºæ˜¯æˆ‘é¡ºä¾¿æŠŠå®ç°èœå•é«˜äº®çš„æ–¹å¼ä¸€å¹¶é‡å†™äº†ã€‚</p>
<p>ä¸‹é¢å…ˆæ¥èŠèŠæˆ‘å¯¹äºå®¹å™¨ç»„ä»¶çš„è®¾è®¡æ€è·¯ï¼š </p>
<p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/blog02.png" alt="è®¾è®¡æ€è·¯"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">â”œâ”€â”€ Layout</div><div class="line">â”‚Â Â  â”œâ”€â”€ Header                 # å¤´éƒ¨ç»„ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ SubList                # å·¦ä¾§èœå•ç»„ä»¶</div><div class="line">â”‚Â Â  â””â”€â”€ Layout.vue             # Layoutç»„ä»¶</div><div class="line">|   â””â”€â”€ index.js</div></pre></td></tr></table></figure>
<blockquote>
<p>æŠŠå®¹å™¨ç»„ä»¶æŠ½è±¡å‡ºæ¥ï¼Œå¯¹äºä»¥åéœ€æ±‚å’ŒUIçš„å˜åŠ¨ï¼Œä¹Ÿå¯ä»¥çµæ´»åº”å˜äº†</p>
</blockquote>
<ul>
<li>å…ˆæ¥è§£å†³èœå•é«˜äº®</li>
</ul>
<p>èœå•é«˜äº®ç”¨<code>$route</code>æ¥è¿›è¡Œå¤„ç†çš„è¯ï¼Œå°±æ¯”è¾ƒç®€æ´äº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç»„ä»¶computed</span></div><div class="line">computed: &#123;</div><div class="line">  currentPreRouteName() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$route.matched[<span class="number">0</span>].name;</div><div class="line">  &#125;</div><div class="line">&#125;,</div><div class="line">methods: &#123;</div><div class="line">  <span class="comment">// é«˜äº®list-item</span></div><div class="line">  computedClass(item) &#123;</div><div class="line">    <span class="keyword">const</span> className = [<span class="string">"list-item"</span>];</div><div class="line">    <span class="keyword">const</span> &#123; name &#125; = item;</div><div class="line">    <span class="keyword">const</span> &#123; currentPreRouteName &#125; = <span class="keyword">this</span>;</div><div class="line">    <span class="keyword">if</span> (currentPreRouteName === name) &#123;</div><div class="line">      className.push(<span class="string">"active"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> className;</div><div class="line">  &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨æ¨¡æ¿ä¸Šçš„å¤„ç†,</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"app-nav-list"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">:class</span>=<span class="string">"computedClass(navItem)"</span> <span class="attr">v-for</span>=<span class="string">"navItem in navList"</span> <span class="attr">:key</span>=<span class="string">"navItem.name"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"navItem.path"</span>&gt;</span></div><div class="line">      &#123;&#123;navItem.meta.navTitle&#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p>æ¢æˆè®¡ç®—<code>$route</code>çš„<code>path</code>è¿›è¡Œç®¡ç†ï¼Œæ¯”èµ·ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä¸éœ€è¦å¢åŠ é¢å¤–çš„çŠ¶æ€ï¼Œä¸éœ€è¦watchï¼Œä¹Ÿè§£å†³äº†ä¹‹å‰åˆ·æ–°é¡µé¢æ— æ³•è‡ªåŠ¨é«˜äº®çš„é—®é¢˜(ä¹‹å‰ä¸ºä»€ä¹ˆä¸èƒ½é«˜äº®ï¼Œå…·ä½“åŸå› æˆ‘è¿˜æ²¡ä»”ç»†ç ”ç©¶ï¼Œé¢å¤–åŠ çš„çŠ¶æ€å¤ªå¤šç»•å¾—æ¯”è¾ƒæ™•ğŸ˜‚)</p>
<ul>
<li>è§£å†³æ— æ³•è·³è½¬404é¡µé¢</li>
</ul>
<p>ä¹‹å‰ä¸èƒ½è·³è½¬åˆ°404é¡µé¢çš„åŸå› ä¸»è¦åœ¨ä¹‹å‰ç”¨äº†åŠ¨æ€è·¯ç”±å»æ¸²æŸ“ç³»ç»Ÿé¡µé¢ï¼Œæ²¡æœ‰åŠ é€»è¾‘å¤„ç†æ‹¦æˆªè·³è½¬åˆ°404ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘é‡‡å–çš„è§£å†³æ–¹æ¡ˆæ˜¯å–æ¶ˆç”¨åŠ¨æ€è·¯ç”±å»ç®¡ç†ï¼Œæ”¹æˆåŒ¹é…å¯¹åº”è·¯ç”±æ¸²æŸ“å¯¹åº”çš„ç³»ç»Ÿ</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  path: <span class="string">"/FZBZ"</span>,</div><div class="line">  name: <span class="string">"FZBZ"</span>,</div><div class="line">  meta: &#123;</div><div class="line">    navTitle: <span class="string">"ç³»ç»Ÿä¸€"</span>,</div><div class="line">    icon: <span class="string">"icon-fzbz"</span></div><div class="line">  &#125;,</div><div class="line">  redirect: <span class="string">"/FZBZ/BaseDateHandle"</span>,</div><div class="line">  component: Layout,</div><div class="line">  children: [</div><div class="line">    &#123;</div><div class="line">      path: <span class="string">"BaseDateHandle"</span>,</div><div class="line">      name: <span class="string">"BaseDateHandle"</span>,</div><div class="line">      meta: &#123;</div><div class="line">        navTitle: <span class="string">"åŸºæœŸæ•°æ®å¤„ç†"</span>,</div><div class="line">        icon: <span class="string">"icon-shujuchanpinliulan"</span></div><div class="line">      &#125;,</div><div class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span></div><div class="line">        <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "BaseDateHandle" */</span> <span class="string">"FZBZ/BaseDateHandle"</span>)</div><div class="line">    &#125;,</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹åº”è·¯ç”±è·¯å¾„ä¾¿æ˜¯<code>http://localhost:9096/#/FZBZ/BaseDateHandle</code>ï¼Œå°‘äº†ä¸€å±‚router-viewï¼Œurlä¹Ÿç®€æ´äº†è®¸å¤šã€‚</p>
<p>åŠ ä¸ª404è·³è½¬ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æ²¡åŒ¹é…åˆ°çš„è·¯å¾„éƒ½è·³è½¬åˆ°404é¡µé¢</span></div><div class="line">&#123;</div><div class="line">  path: <span class="string">"*"</span>,</div><div class="line">  name: <span class="string">"404Page"</span>,</div><div class="line">  component: error404Page</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ç³»ç»Ÿèœå•æ”¹ä¸ºæ ¹æ®è·¯ç”±è¡¨ä¿¡æ¯è¿›è¡Œæ¸²æŸ“"><a href="#ç³»ç»Ÿèœå•æ”¹ä¸ºæ ¹æ®è·¯ç”±è¡¨ä¿¡æ¯è¿›è¡Œæ¸²æŸ“" class="headerlink" title="ç³»ç»Ÿèœå•æ”¹ä¸ºæ ¹æ®è·¯ç”±è¡¨ä¿¡æ¯è¿›è¡Œæ¸²æŸ“"></a>ç³»ç»Ÿèœå•æ”¹ä¸ºæ ¹æ®è·¯ç”±è¡¨ä¿¡æ¯è¿›è¡Œæ¸²æŸ“</h2><p>ä¹‹å‰ç³»ç»Ÿèœå•æ˜¯è¯·æ±‚æœ¬åœ°è‡ªå®šä¹‰jsonå»æ¸²æŸ“çš„ï¼Œè¿™ç§æ–¹å¼æˆ‘è®¤ä¸ºå’Œè·¯ç”±è¡¨ä¸èƒ½å½¢æˆå¾ˆå¥½çš„æ˜ å°„ï¼Œæœªæ¥å¦‚æœæ¥å…¥æƒé™çš„è¯ä¹Ÿå¾ˆä¸æ–¹ä¾¿è¿›è¡Œæ§åˆ¶ï¼Œæ‰€ä»¥æˆ‘ç»Ÿä¸€æ”¹æˆè¯»å–è·¯ç”±è¡¨ä¿¡æ¯è¿›è¡Œæ¸²æŸ“</p>
<p>æˆ‘å†™äº†å‡ ä¸ªå·¥å…·å‡½æ•°ï¼Œæ ¹æ®è·¯ç”±è¡¨å»è¿‡æ»¤è·¯ç”±ä¿¡æ¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">"@/router/routes"</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @param &#123;Object&#125; item</span></div><div class="line"><span class="comment"> * @description åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨children</span></div><div class="line"><span class="comment"> * @returns Boolean</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> hasChild = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> item.children &amp;&amp; item.children.length !== <span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @param &#123;Array&#125; routes è·¯ç”±è¡¨</span></div><div class="line"><span class="comment"> * @description æ ¹æ®è·¯ç”±è¡¨è·å–NavList</span></div><div class="line"><span class="comment"> * @returns &#123;Array&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> getNavList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> navList = routes</div><div class="line">    .filter(<span class="function"><span class="params">item</span> =&gt;</span> item.meta &amp;&amp; item.meta.navTitle)</div><div class="line">    .map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">if</span> (!hasChild(item)) &#123;</div><div class="line">        <span class="comment">// pathç½®ç©ºï¼Œrouter-linkå°±å¯ä»¥é˜»æ­¢è¯¥å¯¼èˆª</span></div><div class="line">        item.path = <span class="string">""</span>;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> item;</div><div class="line">    &#125;);</div><div class="line">  <span class="keyword">return</span> navList;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @param &#123;Object&#125; currentRoute $route</span></div><div class="line"><span class="comment"> * @description æ ¹æ®å½“å‰é¡µé¢è·¯ç”±è¿›è¡ŒåŒ¹é…è·¯ç”±è¡¨ï¼Œè·å–äºŒçº§è·¯ç”±è¡¨</span></div><div class="line"><span class="comment"> * @returns &#123;Array&#125; subNavList</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSubNavList = <span class="function"><span class="params">currentRoute</span> =&gt;</span> &#123;</div><div class="line">  <span class="comment">// å…ˆè·å–ä¸€çº§è·¯ç”±å</span></div><div class="line">  <span class="keyword">const</span> preRouteName = currentRoute.matched[<span class="number">0</span>].name;</div><div class="line">  <span class="keyword">const</span> len = routes.length;</div><div class="line">  <span class="comment">// ä»è·¯ç”±è¡¨é‡Œé¢æ‰¾åˆ°å¯¹åº”çš„äºŒçº§èœå•</span></div><div class="line">  <span class="keyword">let</span> SubNavList = [];</div><div class="line">  <span class="keyword">let</span> i = <span class="number">-1</span>;</div><div class="line">  <span class="keyword">while</span> (++i &lt; len) &#123;</div><div class="line">    <span class="keyword">if</span> (preRouteName === routes[i].name) &#123;</div><div class="line">      SubNavList = routes[i].children;</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> SubNavList;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæ˜¯è·å–ç³»ç»Ÿèœå•ï¼Œä¸€ä¸ªæ˜¯æ ¹æ®ç³»ç»Ÿåå»è·å–å¯¹åº”çš„äºŒçº§å­èœå•ä¿¡æ¯</p>
<p>Portalé¡µå’ŒLayouté¡µçš†ç”±è¯¥æ–¹å¼è¿›è¡Œæ¸²æŸ“</p>
<h2 id="è·¯ç”±è¡¨æŒ‰ç³»ç»Ÿåˆ’åˆ†è¿›è¡Œé‡æ„"><a href="#è·¯ç”±è¡¨æŒ‰ç³»ç»Ÿåˆ’åˆ†è¿›è¡Œé‡æ„" class="headerlink" title="è·¯ç”±è¡¨æŒ‰ç³»ç»Ÿåˆ’åˆ†è¿›è¡Œé‡æ„"></a>è·¯ç”±è¡¨æŒ‰ç³»ç»Ÿåˆ’åˆ†è¿›è¡Œé‡æ„</h2><p>å› ä¸ºæœ‰6ä¸ªç³»ç»Ÿï¼Œæ¯ä¸ªç³»ç»Ÿåˆæœ‰å‡ åä¸ªé¡µé¢ï¼Œè¿™æ ·ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªjsé‡Œé¢ï¼Œä¼šæ˜¾å¾—æ— æ¯”ç¬¨é‡ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ”¹é”™é‡Œé¢çš„è·¯ç”±ä¿¡æ¯ï¼Œæ‰€ä»¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘æ”¹æˆæŒ‰ç³»ç»Ÿååˆ’åˆ†è·¯ç”±è¡¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">â”œâ”€â”€ router                      # è·¯ç”±è¡¨ç®¡ç†</div><div class="line">â”‚Â Â  â””â”€â”€ routes</div><div class="line">â”‚Â Â      â”œâ”€â”€ fzbz.js             </div><div class="line">â”‚Â Â      â”œâ”€â”€ fzsc.js             </div><div class="line">â”‚Â Â      â”œâ”€â”€ ghss.js             </div><div class="line">â”‚Â Â      â”œâ”€â”€ jcyj.js             </div><div class="line">â”‚Â Â      â”œâ”€â”€ zbmx.js             </div><div class="line">â”‚Â Â      â””â”€â”€ zxpg.js</div></pre></td></tr></table></figure>
<p><code>index.js</code>é‡Œé¢æ³¨å†Œè·¯ç”±ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// nav-listæŒ‰ç…§æŒ‚è½½è·¯ç”±é¡ºåºæ¸²æŸ“</span></div><div class="line"><span class="keyword">import</span> fzbz <span class="keyword">from</span> <span class="string">"./fzbz"</span>;</div><div class="line"><span class="keyword">import</span> fzsc <span class="keyword">from</span> <span class="string">"./fzsc"</span>;</div><div class="line"><span class="keyword">import</span> ghss <span class="keyword">from</span> <span class="string">"./ghss"</span>;</div><div class="line"><span class="keyword">import</span> jcyj <span class="keyword">from</span> <span class="string">"./jcyj"</span>;</div><div class="line"><span class="keyword">import</span> zxpg <span class="keyword">from</span> <span class="string">"./zxpg"</span>;</div><div class="line"><span class="keyword">import</span> zbmx <span class="keyword">from</span> <span class="string">"./zbmx"</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</div><div class="line">  ...,</div><div class="line">  &#123;</div><div class="line">    ...fzbz</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...fzsc</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...ghss</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...jcyj</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...zxpg</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...zbmx</div><div class="line">  &#125;</div><div class="line">];</div></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯ï¼Œå¯¹æ–°åŠ è¿›æ¥çš„å¼€å‘äººå‘˜ä¹Ÿä¼šéå¸¸å‹å¥½ï¼Œä¸€çœ¼å°±èƒ½çŸ¥é“è¯¥å»å“ªé‡Œé…ç½®è·¯ç”±è¡¨å•¦ğŸ˜</p>
<h2 id="ç›®å½•ç»“æ„é‡æ–°æ•´ç†"><a href="#ç›®å½•ç»“æ„é‡æ–°æ•´ç†" class="headerlink" title="ç›®å½•ç»“æ„é‡æ–°æ•´ç†"></a>ç›®å½•ç»“æ„é‡æ–°æ•´ç†</h2><p>ä¹‹å‰çš„<code>src</code>ç›®å½•ç»“æ„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">â”œâ”€â”€ src</div><div class="line">â”‚Â Â  â”œâ”€â”€ components                  # é¡µé¢å’Œé¡µé¢ç»„ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ App.vue                     # Vueæ ¹ç»„ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ main.js                     # é¡¹ç›®å…¥å£æ–‡ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ router                      # è·¯ç”±</div><div class="line">â”‚Â Â  â”œâ”€â”€ store                       # vuex</div><div class="line">â”‚Â Â  â”œâ”€â”€ style                       # å…¨å±€css</div><div class="line">â”‚Â Â  â”œâ”€â”€ utils                       # å·¥å…·å‡½æ•°</div><div class="line">â”‚Â Â  â”œâ”€â”€ registerComponent           # æ³¨å†Œå…¨å±€ç»„ä»¶</div></pre></td></tr></table></figure>
<p>æ•´ç†æˆğŸ‘‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">â”œâ”€â”€ src</div><div class="line">â”‚Â Â  â”œâ”€â”€ main.js                     # é¡¹ç›®å…¥å£æ–‡ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ App.vue                     # Vueæ ¹ç»„ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ layout                      # å®¹å™¨å¸ƒå±€ç»„ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ api                         # åç«¯apiç»Ÿä¸€ç®¡ç†</div><div class="line">â”‚Â Â  â”œâ”€â”€ assets                      # é™æ€æ–‡ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ components                  # é€šç”¨ç»„ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ icon                        # icon</div><div class="line">â”‚Â Â  â”œâ”€â”€ mock                        # mockjs</div><div class="line">â”‚Â Â  â”œâ”€â”€ plugins                     # æ’ä»¶ç®¡ç†</div><div class="line">â”‚Â Â  â”œâ”€â”€ register                    # ç»Ÿä¸€æ³¨å†Œechartsã€å…¨å±€ç»„ä»¶</div><div class="line">â”‚Â Â  â”œâ”€â”€ router                      # è·¯ç”±è¡¨ç®¡ç†</div><div class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ routes                  # ç³»ç»Ÿè·¯ç”±è¡¨</div><div class="line">â”‚Â Â  â”œâ”€â”€ store                       # vuex</div><div class="line">â”‚Â Â  â”œâ”€â”€ styles                      # å…¨å±€scsså˜é‡ã€å…¨å±€æ ·å¼</div><div class="line">â”‚Â Â  â”œâ”€â”€ utils                       # é€šç”¨å·¥å…·å‡½æ•°</div><div class="line">â”‚Â Â  â””â”€â”€ views                       # é¡µé¢</div><div class="line">â””â”€â”€ vue.config.js                   # å·¥ç¨‹é…ç½®æ–‡ä»¶</div><div class="line">â””â”€â”€ test                            # å•å…ƒæµ‹è¯•</div></pre></td></tr></table></figure>
<h2 id="pre-commit"><a href="#pre-commit" class="headerlink" title="pre-commit"></a>pre-commit</h2><p>pre-commitä½œç”¨å¥½å¤„ä¸ç”¨å¤šè¯´ï¼Œgit commitå‰æ‰§è¡Œlint</p>
<p>å®‰è£…<code>husky</code>ï¼Œ<code>lint-stage</code>æ’ä»¶ï¼Œpackage.jsonä¸­é…ç½®<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="string">"lint-staged"</span>: &#123;</div><div class="line">  <span class="string">"src/**/*.&#123;vue,js&#125;"</span>: [</div><div class="line">    <span class="string">"yarn lint"</span>,</div><div class="line">    <span class="string">"git add"</span></div><div class="line">  ],</div><div class="line">  <span class="string">"src/**/*.&#123;json,md,css,scss&#125;"</span>: [</div><div class="line">    <span class="string">"prettier --write"</span>,</div><div class="line">    <span class="string">"git add"</span></div><div class="line">  ]</div><div class="line">&#125;,</div><div class="line"><span class="string">"husky"</span>: &#123;</div><div class="line">  <span class="string">"hooks"</span>: &#123;</div><div class="line">    <span class="string">"pre-commit"</span>: <span class="string">"lint-staged"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="sass-å‡½æ•°ç¼–å†™"><a href="#sass-å‡½æ•°ç¼–å†™" class="headerlink" title="sass å‡½æ•°ç¼–å†™"></a>sass å‡½æ•°ç¼–å†™</h2><p>é¢œè‰²ã€å­—ä½“ã€ç­‰å˜é‡å…¨å±€ç®¡ç†ï¼Œå„ç³»ç»ŸåŒç”¨ä¸€å¥—ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">mixin</span> scw($size, $color: $fontColor_1, $weight: <span class="number">400</span>) &#123;</div><div class="line">  font-size: $size;</div><div class="line">  color: $color;</div><div class="line">  font-weight: $weight;</div><div class="line">&#125;</div><div class="line">// ä¸€çº§å­—ä½“</div><div class="line">@<span class="keyword">mixin</span> T1 &#123;</div><div class="line">  @<span class="keyword">include</span> scw(<span class="number">1.46rem</span>, $fontColor_1, <span class="number">700</span>);</div><div class="line">&#125;</div><div class="line">// äºŒçº§å­—ä½“</div><div class="line">@<span class="keyword">mixin</span> T2 &#123;</div><div class="line">  @<span class="keyword">include</span> scw(<span class="number">1.25rem</span>, $fontColor_1, <span class="number">700</span>);</div><div class="line">&#125;</div><div class="line">// ä¸‰çº§å­—ä½“</div><div class="line">@<span class="keyword">mixin</span> T3 &#123;</div><div class="line">  @<span class="keyword">include</span> scw(<span class="number">0.94rem</span>, $fontColor_1, <span class="number">500</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¯”å¦‚æŒ‰é’®çš„æ ·å¼ç®¡ç†ï¼Œåœ¨ç»„ä»¶é‡Œæ˜¯è¿™ä¹ˆç”¨çš„ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">mixin</span> btn-super($size: <span class="number">1</span>, $bgcolor: $color1890ff, $fontcolor: $colorffffff) &#123;</div><div class="line">  @<span class="keyword">if</span> $size == <span class="number">1</span> &#123;</div><div class="line">    @<span class="keyword">include</span> B1();</div><div class="line">  &#125;</div><div class="line">  @<span class="keyword">if</span> $size == <span class="number">2</span> &#123;</div><div class="line">    @<span class="keyword">include</span> B2();</div><div class="line">  &#125;</div><div class="line">  @<span class="keyword">if</span> $size == <span class="number">3</span> &#123;</div><div class="line">    @<span class="keyword">include</span> B3();</div><div class="line">  &#125;</div><div class="line">  @<span class="keyword">include</span> scw(<span class="number">0.83rem</span>, $fontcolor, normal);</div><div class="line">  @<span class="keyword">include</span> btn-assist();</div><div class="line">  background-color: $bgcolor;</div><div class="line">  border-color: $bgcolor;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ­¤å¤–ï¼Œç³»ç»Ÿå…¨éƒ¨ä½¿ç”¨ <code>rem</code> å¸ƒå±€ï¼Œé‡‡ç”¨ <code>vw +font-size</code> æ–¹æ¡ˆï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span> &#123;</div><div class="line">  <span class="attribute">font-size</span>: <span class="number">1vw</span> <span class="meta">!important</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="é¦–å±ä¼˜åŒ–"><a href="#é¦–å±ä¼˜åŒ–" class="headerlink" title="é¦–å±ä¼˜åŒ–"></a>é¦–å±ä¼˜åŒ–</h2><p>ä¹‹å‰å¬è¯´ç”±äºé™æ€èµ„æºæ¯”è¾ƒå¤šï¼Œé¦–å±åŠ è½½æ¯”è¾ƒæ…¢ã€‚æˆ‘buildäº†ä¸‹å‘ç°ï¼Œ<code>app.js</code>å±…ç„¶é«˜è¾¾<strong>17m</strong>ï¼è¿™æ ·åŠ è½½é¦–å±è‚¯å®šæ…¢äº†ï¼æˆ‘è¿½è¸ªäº†ä¸‹å‘ç°ï¼Œéƒ½æ˜¯ä¸€äº›åœ°å›¾jsonæ–‡ä»¶å¤ªå¤§å¯¼è‡´çš„ï¼Œä¸»è¦æ˜¯ä¸‹é¢è¿™äº›ä»£ç äº§ç”Ÿçš„é—®é¢˜ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">echarts.registerMap(<span class="string">"china"</span>, <span class="built_in">require</span>(<span class="string">"../static/map/china.json"</span>);</div><div class="line">echarts.registerMap(<span class="string">"guangzhou"</span>,<span class="built_in">require</span>(<span class="string">"../static/map/cities/guangzhou.json"</span>));</div><div class="line">echarts.registerMap(<span class="string">"beijing"</span>, <span class="built_in">require</span>(<span class="string">"../static/map/cities/beijing.json"</span>));</div><div class="line">echarts.registerMap(<span class="string">"shenyang"</span>, <span class="built_in">require</span>(<span class="string">"../static/map/cities/shenyang.json"</span>));</div></pre></td></tr></table></figure>
<p><code>require</code>æ˜¯åŒæ­¥å¼•å…¥ï¼Œwebpackä¼šæŠŠè¿™äº›åºå¤§çš„<code>json</code>å…¨éƒ¨åŒæ­¥æ‰“åŒ…åˆ°<code>app.js</code>é‡Œé¢ï¼Œæ‰€ä»¥ä¼šéå¸¸å¤§ã€‚åæ¥å‡¡ç«¥é‹æä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œé—®æˆ‘èƒ½ä¸èƒ½ç”¨å¼‚æ­¥åŠ è½½ï¼Œè¿™æ ·ä¼šä¸ä¼šä½“ç§¯å°ä¸€ç‚¹ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ŒæŠŠä¸Šé¢ä»£ç æ”¹æˆè¯»å–æœ¬åœ°jsonï¼Œè¯»å–å®Œåå†è¿›è¡Œæ³¨å†Œï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// é‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼æ³¨å†Œjsonåœ°å›¾</span></div><div class="line"><span class="keyword">const</span> jsonMap = &#123;</div><div class="line">  china: <span class="string">"static/map/china.json"</span>,</div><div class="line">  chinacity: <span class="string">"static/map/china-cities.json"</span>,</div><div class="line">  cj_citylevel: <span class="string">"static/map/changjiang_city_level.json"</span>,</div><div class="line">  cj_up_mid_down: <span class="string">"static/map/changjiang_up_mid_down.json"</span>,</div><div class="line">  cj_provincial: <span class="string">"static/map/changjiang_provincial.json"</span>,</div><div class="line">  ningxiacity: <span class="string">"static/map/Ningxia.json"</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> jsonMap) &#123;</div><div class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(jsonMap, i))</div><div class="line">    axios.get(jsonMap[i]).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</div><div class="line">      echarts.registerMap(i, res.data);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»æµ‹è¯•ï¼Œæ‰“åŒ…åçš„ä½“ç§¯æ˜æ˜¾å‡å°‘ï¼ä½†æ˜¯ï¼Œè¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œæ¯”å¦‚æœ‰äº›ç³»ç»Ÿçš„è·¯ç”±ç»„ä»¶ä¸æ˜¯å¼‚æ­¥ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å…¨éƒ¨æ”¹æˆç»„ä»¶æ‡’åŠ è½½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  ...,</div><div class="line">  component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "BaseDateHandle" */</span> <span class="string">"FZBZ/BaseDateHandle"</span>)&#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å†æ‰“åŒ…ï¼Œ<code>app.js</code>å·²ç»å‡å°‘åˆ°<code>180k</code>å·¦å³äº†ï¼Œä»<code>17m</code>åˆ°<code>180k</code>ï¼Œé€Ÿåº¦æå‡å¯ä»¥è¯´æ˜¯éå¸¸æ˜æ˜¾äº†ã€‚</p>
<p>ä½†æ˜¯<code>vendor.js</code>è¿˜æ˜¯é«˜è¾¾<code>2m</code>ï¼Œä¸»è¦åŸå› ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹çš„åŒ…å¤ªå¤šï¼Œ<code>iview</code>ä¹Ÿæ²¡æ”¹æˆæŒ‰éœ€åŠ è½½ï¼Œ<code>echarts</code>ä¹Ÿæ˜¯ï¼Œä»¥åä¼šé’ˆå¯¹è¿™äº›åŒ…è¿›è¡Œç›¸å…³ä¼˜åŒ–ã€‚</p>
<p>æ­¤å¤–ï¼Œä¹‹å‰æ‰“åŒ…çš„ä»£ç æ˜¯æ²¡æœ‰é…ç½®<code>gzip</code>çš„ï¼Œå¼€å¯<code>gzip</code>é€Ÿåº¦ä¼šæ›´å¿«ï¼Œä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä½¿ç”¨äº†webpackçš„ä¸€ä¸ªæ’ä»¶ï¼ŒåŠ ç‚¹é…ç½®å°±å¯å®ç°</p>
<p><code>vue.config.js</code>å¢åŠ é…ç½®<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> CompressionPlugin = <span class="built_in">require</span>(<span class="string">"compression-webpack-plugin"</span>);</div><div class="line"><span class="keyword">const</span> productionGzipExtensions = [<span class="string">"js"</span>, <span class="string">"css"</span>];</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  configureWebpack: &#123;</div><div class="line">    <span class="comment">// gzip</span></div><div class="line">    plugins: process.env.NODE_ENV === <span class="string">"production"</span> ? [</div><div class="line">      <span class="keyword">new</span> CompressionPlugin(&#123;</div><div class="line">        filename: <span class="string">"[path].gz[query]"</span>,</div><div class="line">        algorithm: <span class="string">"gzip"</span>,</div><div class="line">        test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"\\.("</span> + productionGzipExtensions.join(<span class="string">"|"</span>) + <span class="string">")$"</span>),</div><div class="line">        threshold: <span class="number">10240</span>,</div><div class="line">        minRatio: <span class="number">0.8</span></div><div class="line">      &#125;)</div><div class="line">    ] : []</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é¦–å±ä¼˜åŒ–ï¼Œæ°¸æ— æ­¢å¢ƒï¼</p>
<h2 id="å…¼å®¹IE11"><a href="#å…¼å®¹IE11" class="headerlink" title="å…¼å®¹IE11"></a>å…¼å®¹IE11</h2><p>è¿™ä¸ªç³»ç»Ÿéœ€è¦å…¼å®¹ie11ï¼Œç°åœ¨æœ‰äº† <code>babel</code> åŠ æŒï¼Œå¹¶ä¸éœ€è¦æ‹…å¿ƒå¤ªå¤š <code>js</code> æ–¹é¢çš„é—®é¢˜ã€‚ç°åœ¨cli3ä¹Ÿå·²ç»é»˜è®¤å¸®æˆ‘ä»¬å¼•å…¥ <code>promise</code>ã€ <code>es6.symbol</code> ç­‰ä¸€äº›é‡è¦æ¨¡å—çš„ <code>polyfill</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦æˆ‘ä»¬é¢å¤–é…ç½®ã€‚ç›®å‰çš„é—®é¢˜ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯ç”¨çš„ç¬¬ä¸‰æ–¹åº“<code>vue-echarts-v3</code>æ˜¯ç”¨<code>es6</code>ç¼–å†™çš„ï¼Œç”±äº<code>vuecli3</code>åº•å±‚çš„<code>webpack</code>é…ç½®ä¸­ï¼Œ<code>node_modules</code>ä¸‹çš„åŒ…æ˜¯é»˜è®¤ä¸èµ°<code>Babel</code>ç¼–è¯‘çš„ï¼Œæˆ‘ä»¬åœ¨<code>npm</code>è£…çš„åŒ…ï¼Œä½œè€…æ²¡æœ‰å¸®æˆ‘ä»¬å»ç¼–è¯‘ï¼Œè€Œæ˜¯å¸Œæœ›æˆ‘ä»¬æ‰‹åŠ¨å»é…ç½®ç¼–è¯‘<a href="https://github.com/xlsdg/vue-echarts-v3#usage" target="_blank" rel="external">vue-echarts-v3ä½¿ç”¨éœ€æ±‚</a></p>
<p>å¢åŠ <code>vue.config.js</code>é…ç½®ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  transpileDependencies: [<span class="string">"node_modules/vue-echarts-v3"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ğŸ‘†é—®é¢˜è§£å†³</p>
<p>butâ€¦</p>
<p>ğŸ‘‡è¿˜æœ‰ä¸ªé—®é¢˜</p>
<p>å‡¡ç«¥é‹ååº”æœ‰çš„é¡µé¢åœ¨ieä¸­æ‰“ä¸å¼€ï¼Œç»è¿½è¸ªï¼Œå‡¡æ˜¯ç”¨åˆ°äº†<code>iview</code>çš„<code>Tabs</code>ç»„ä»¶éƒ½æ‰“ä¸å¼€ï¼Œé€šè¿‡æŠ¥é”™ä¿¡æ¯ï¼ŒæŸ¥åˆ°<code>Tabs</code>ç»„ä»¶é‡Œç”¨åˆ°äº†æ•°ç»„<code>findIndex</code>è¿™ä¸ªæ¯”è¾ƒæ–°çš„apiï¼Œè¿™ä¸ªapiåœ¨æ‰€æœ‰çš„ieä¸­éƒ½ä¸æ”¯æŒã€‚å› ä¸º<code>iview</code>ä¹Ÿæ˜¯<code>node_modules</code>ä¸‹çš„ï¼ŒåŒæ ·ä¹Ÿæ— æ³•èµ°Babelç¼–è¯‘ï¼Œæˆ‘é‡‡å–çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œæ‰‹åŠ¨å¼•ç”¨polyfillï¼Œä¸ç”¨ä¸Šé¢çš„æ–¹æ¡ˆäº†ï¼Œå› ä¸º<code>iview</code>ç”Ÿäº§ç‰ˆå·²ç»è¢«<code>Babel</code>ç¼–è¯‘è¿‡äº†ï¼Œåªä¸è¿‡æ²¡æœ‰ç”¨åˆ°<code>babel-polyfill</code>ã€‚</p>
<p>åæ¥ï¼ŒæŸ¥é˜…<code>vuecli3</code>çš„<a href="https://cli.vuejs.org/zh/guide/browser-compatibility.html#polyfill" target="_blank" rel="external">polyfillé€‰é¡¹</a>ï¼Œå¯ä»¥é€šè¿‡é…ç½®å®ç°ç›¸å…³apiçš„<code>polyfill</code>ï¼Œç„¶åæŒ‰éœ€å¼•å…¥ï¼Œè¿™ç§ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="è‡ªåŠ¨æ³¨å†Œå…¨å±€ç»„ä»¶"><a href="#è‡ªåŠ¨æ³¨å†Œå…¨å±€ç»„ä»¶" class="headerlink" title="è‡ªåŠ¨æ³¨å†Œå…¨å±€ç»„ä»¶"></a>è‡ªåŠ¨æ³¨å†Œå…¨å±€ç»„ä»¶</h2><p>ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬æ ¹æ®UIè®¾è®¡çš„ç»„ä»¶ï¼Œå¼€å‘äº†è®¸å¤šå…¨å±€ç»„ä»¶ï¼Œæˆ‘å‘ç°æ¯ä¸€æ¬¡å¼€å‘å®Œæˆï¼Œéƒ½è¦å»<code>registerComponent.js</code>ä¸­è¿›è¡Œæ‰‹åŠ¨æ³¨å†Œï¼Œæ„Ÿè§‰æ¯”è¾ƒéº»çƒ¦ï¼Œäºæ˜¯æˆ‘å†³å®šç”¨è‡ªåŠ¨æ³¨å†Œç»„ä»¶æ–¹æ³•è¿›è¡Œå…¨å±€æ³¨å†Œï¼Œä¸€åŠ³æ°¸é€¸ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span>;</div><div class="line"></div><div class="line"><span class="comment">// æ£€ç´¢ç›®å½•ä¸‹çš„æ¨¡å—</span></div><div class="line"><span class="keyword">const</span> req = <span class="built_in">require</span>.context(<span class="string">"."</span>, <span class="literal">true</span>, /\.vue$/);</div><div class="line"></div><div class="line">req.keys().forEach(<span class="function"><span class="params">fileName</span> =&gt;</span> &#123;</div><div class="line">  <span class="comment">// requireæ¨¡å—</span></div><div class="line">  <span class="comment">// è¿‡æ»¤æ‰ä¸ä»¥ Nr å¼€å¤´çš„æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚eyemap</span></div><div class="line">  <span class="keyword">if</span> (fileName.includes(<span class="string">"Nr"</span>)) &#123;</div><div class="line">    <span class="keyword">const</span> componentConfig = req(fileName);</div><div class="line">    <span class="keyword">const</span> name =</div><div class="line">      fileName.name ||</div><div class="line">      fileName.replace(<span class="regexp">/^\.\/(.*\/)?/</span>, <span class="string">""</span>).replace(<span class="regexp">/\.vue$/</span>, <span class="string">""</span>);</div><div class="line">    <span class="comment">// è¿‡æ»¤æ‰ä¸ä»¥ Nr å¼€å¤´çš„ .vue æ–‡ä»¶</span></div><div class="line">    /^Nr/.test(name) &amp;&amp;</div><div class="line">      Vue.component(name, componentConfig.default || componentConfig);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨<code>registerComponent.js</code>ä¸­åŠ å…¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å…¨å±€ç»„ä»¶æ³¨å†Œ</span></div><div class="line"><span class="keyword">import</span> <span class="string">"@/components"</span>;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œåœ¨<code>components</code>æ–‡ä»¶ä¸‹çš„æ‰€æœ‰ç»„ä»¶éƒ½è§†ä¸ºå…¨å±€ç»„ä»¶äº†</p>
<p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/A966FB85-843C-475C-B830-1A1A736BB658.png" alt="å…¨å±€ç»„ä»¶"></p>
<p>å…¶å®ï¼Œè‡ªåŠ¨æ³¨å†Œçš„æ–¹æ³•ä¹Ÿå¯ä»¥åœ¨åˆ«çš„åœ°æ–¹è¿›è¡Œä½¿ç”¨ï¼Œä¾‹å¦‚è‡ªåŠ¨æ³¨å†Œ <code>vuex module</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> files = <span class="built_in">require</span>.context(<span class="string">"."</span>, <span class="literal">true</span>, /\.js$/);</div><div class="line"><span class="keyword">const</span> modules = &#123;&#125;;</div><div class="line"></div><div class="line">files.keys().forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span> (key === <span class="string">"./index.js"</span>) &#123;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">const</span> moduleName = key.split(<span class="string">"/"</span>)[<span class="number">1</span>].split(<span class="string">"."</span>)[<span class="number">0</span>];</div><div class="line">  modules[moduleName] = files(key).default;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> modules;</div></pre></td></tr></table></figure>
<p>è¿˜æœ‰è‡ªåŠ¨æ³¨å†Œå…¨å±€æŒ‡ä»¤ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> req = <span class="built_in">require</span>.context(<span class="string">"."</span>, <span class="literal">false</span>, /\.\/(?!index\.)\w*\.js$/);</div><div class="line"></div><div class="line">req.keys().forEach(<span class="function"><span class="params">fileName</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> model = req(fileName);</div><div class="line">  <span class="keyword">const</span> name = fileName.replace(<span class="regexp">/\.\//</span>, <span class="string">""</span>).replace(<span class="regexp">/\.js$/</span>, <span class="string">""</span>);</div><div class="line">  Vue.directive(name, model.default || model);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹"><a href="#ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹" class="headerlink" title="ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹"></a>ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹</h2><p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7%E6%80%BB%E7%BB%93-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B.png" alt="åˆå§‹åŒ–æµç¨‹"></p>
<p>å›¾ä¸­æœ‰å‡ºç°<strong>è¯»å–é…ç½®æ–‡ä»¶</strong>è¿™ä¹ˆä¸€ç§è¿‡ç¨‹ã€‚æœ‰ä¸€ä¸ªå¾ˆé‡è¦éœ€æ±‚å°±æ˜¯ç³»ç»Ÿè¦ç»™åˆ°å®æ–½äººå‘˜åˆ°å®¢æˆ·ç°åœºè¿›è¡Œéƒ¨ç½²å’Œé…ç½®ï¼Œéœ€è¦æš´éœ²ä¸€äº›é…ç½®å‚æ•°ç»™ä»–ä»¬è¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚ <code>api</code> ã€åœ°å›¾æœåŠ¡åœ°å€è¿™äº›ã€‚å¼€å§‹æˆ‘æ˜¯ç”¨vuecli3æä¾›çš„ <code>.env</code> ç¯å¢ƒå˜é‡å»è§£å†³çš„ï¼Œä½†æ˜¯ä¸è¶³çš„æ˜¯æ¯æ¬¡ä¿®æ”¹å®Œéƒ½è¦é‡æ–° <code>yarn build</code> æ‰ç”Ÿæ•ˆï¼Œè¿™æ ·æ•ˆç‡å¤ªæ…¢äº†ã€‚æ‰€ä»¥æˆ‘å†³å®šæŠŠé…ç½®jsonæ–‡ä»¶æåˆ°å¤–é¢ï¼Œåœ¨ç³»ç»Ÿåˆå§‹åŒ–å‰å»è¯»å–å¹¶æ³¨å…¥åˆ°å†…éƒ¨ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³é‡æ–°æ‰“åŒ…çš„é—®é¢˜äº†ã€‚</p>
<p>ä¸‹é¢è¯»é…ç½®æ˜¯å®ç°ç»†èŠ‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</div><div class="line"><span class="keyword">import</span> cachedFn <span class="keyword">from</span> <span class="string">"./cachedFn"</span>;</div><div class="line"></div><div class="line"><span class="comment">// æ— è®ºå¤šå°‘æ¬¡importæ‰§è¡Œå‡½æ•°ï¼Œéƒ½åªä¼šä½¿ç”¨è¢«ç¼“å­˜çš„å€¼</span></div><div class="line"><span class="comment">// é¿å…é‡å¤è¯·æ±‚</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> cachedFn(<span class="keyword">async</span> () =&gt; &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.get(<span class="string">"static/appConfig.json"</span>);</div><div class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: mapConfig &#125; = <span class="keyword">await</span> axios.get(</div><div class="line">      <span class="string">"static/mockdata/YZT_JSON/mapinit.json"</span></div><div class="line">    );</div><div class="line">    <span class="keyword">const</span> env = process.env.NODE_ENV;</div><div class="line">    <span class="built_in">window</span>.__VERSION__ = data.VERSION;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      config: data[env],</div><div class="line">      mapConfig</div><div class="line">    &#125;;</div><div class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</div><div class="line">    <span class="built_in">console</span>.log(error);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">"æ— æ³•è¯»å–é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ï¼Œè¯·æ£€æµ‹æ˜¯å¦é…ç½®æ­£ç¡®ï¼"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œæœ‰ç”¨åˆ°äº†ä¸€ä¸ªç¼“å­˜å‡½æ•°ï¼Œå› ä¸ºæœ‰åˆ«çš„åœ°æ–¹ä¹Ÿéœ€è¦è¯»é…ç½®ï¼Œä½¿ç”¨è¯¥å‡½æ•°å¯ä»¥é¿å…é‡å¤è¯·æ±‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> cachedFn = <span class="function"><span class="params">fn</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> cacheMap = <span class="keyword">new</span> <span class="built_in">Map</span>();</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> hit = cacheMap.get(fn);</div><div class="line">    <span class="keyword">if</span> (!hit) &#123;</div><div class="line">      <span class="keyword">const</span> data = fn();</div><div class="line">      cacheMap.set(fn, data);</div><div class="line">      <span class="keyword">return</span> data;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> hit;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>å–åˆ°é…ç½®ä¿¡æ¯åï¼Œæ³¨å…¥åˆ° <code>vuex</code> storeé‡Œé¢</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">(<span class="keyword">async</span> () =&gt; &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="comment">// è·å–é…ç½®ä¿¡æ¯</span></div><div class="line">    <span class="keyword">const</span> &#123; config, mapConfig &#125; = <span class="keyword">await</span> getConfig();</div><div class="line">    <span class="comment">// åˆå§‹åŒ–åŸºç¡€ config</span></div><div class="line">    store.commit(SET_CONFIG, config);</div><div class="line">    store.commit(MAP_INIT_CONFIG, mapConfig);</div><div class="line">    <span class="comment">// åˆå§‹åŒ– eyemap</span></div><div class="line">    <span class="keyword">const</span> &#123; ARCGISURL &#125; = config;</div><div class="line">    Vue.use(eyemap, &#123;</div><div class="line">      load: &#123;</div><div class="line">        arcgisUrl: ARCGISURL</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// æŒ‚è½½å®ä¾‹</span></div><div class="line">    <span class="keyword">new</span> Vue(&#123;</div><div class="line">      router,</div><div class="line">      store,</div><div class="line">      render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</div><div class="line">    &#125;).$mount(<span class="string">"#app"</span>);</div><div class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</div><div class="line">    <span class="keyword">return</span> iview.Notice.error(&#123;</div><div class="line">      title: <span class="string">"é…ç½®å‡ºé”™"</span>,</div><div class="line">      desc: error</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨vueç»„ä»¶é‡Œé¢ä¹Ÿå¯ä»¥æ‹¿åˆ°ç›¸å…³é…ç½®ä¿¡æ¯è¿›è¡Œä¸šåŠ¡å¼€å‘äº†ã€‚</p>
<h2 id="æƒé™æ§åˆ¶"><a href="#æƒé™æ§åˆ¶" class="headerlink" title="æƒé™æ§åˆ¶"></a>æƒé™æ§åˆ¶</h2><p>å…³äºæƒé™æ§åˆ¶éƒ¨åˆ†ï¼Œå› ä¸ºå½“å‰ç³»ç»Ÿå†³å®šåªæ§åˆ¶åˆ°å­ç³»ç»Ÿå’Œå­ç³»ç»Ÿä¸‹çš„èœå•ï¼Œæ‰€ä»¥è¿™äº›éƒ½æ˜¯åœ¨è¿ç»´ç³»ç»Ÿä¸­è¿›è¡Œé…ç½®ï¼Œç„¶ååœ¨ç™»å½•æ—¶ä¼šå»è·å–ç›¸å…³ä¿¡æ¯ï¼Œç„¶ååœ¨<strong>æ¸²æŸ“å­ç³»ç»Ÿå’Œå­ç³»ç»Ÿèœå•åˆ—è¡¨å‰è¿›è¡Œè·¯ç”±æ¯”å¯¹è¿‡æ»¤</strong>ï¼Œå› ä¸ºåœ¨å‰é¢å·²ç»<strong>å®ç°ç”¨è¯»è·¯ç”±è¡¨</strong>å»æ¸²æŸ“ï¼Œæ‰€ä»¥æ¯”å¯¹è¿‡æ»¤è·¯ç”±ä¿¡æ¯ä¹Ÿä¸ç®—å¤æ‚ï¼Œä¹Ÿä¸éœ€è¦ç”¨åˆ°è·¯ç”±æ‹¦æˆªã€æŒ‡ä»¤æ§åˆ¶æ˜¾éšç­‰ç­‰ã€‚ä»£ç æš‚æ—¶ä¸è´´äº†ï¼Œæ€è·¯å°±æ˜¯è¿™æ ·å­ï¼Œä»¥åå¯èƒ½åœ¨æƒé™æ–¹é¢æœ‰æ›´æ·±çš„æ§åˆ¶ï¼Œåˆ°æ—¶å®ç°ä¹‹åå†å…·ä½“èŠèŠã€‚</p>
<h2 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h2><p>åœ¨ä¸€äº›æ¯”è¾ƒé‡è¦çš„å·¥å…·æ¨¡å—ï¼Œè¿˜æ˜¯éœ€è¦è¿›è¡Œå•å…ƒæµ‹è¯•çš„ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä»£ç çš„å¥å£®æ€§ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å¼•å…¥äº†å½“å‰æ¯”è¾ƒæµè¡Œçš„æµ‹è¯•æ¡†æ¶ <code>jest</code> ï¼Œå’Œ <code>mocha</code> ä¸åŒçš„æ˜¯ï¼Œ<code>jest</code> é‡Œé¢é›†æˆäº†å¾ˆå¤šå·¥å…·ï¼Œä¸éœ€è¦ä¸€ä¸ªä¸ªå»å®‰è£…ï¼Œåƒ <code>mocha</code> è¦é…åˆå¾ˆå¤šåº“å»ä½¿ç”¨ï¼Œæ‰€ä»¥è¦å­¦ä¹ è¿™äº›åº“çš„ <code>api</code>ï¼Œåœ¨ä¸åŒæ–‡æ¡£ä¸Šè¿›è¡Œåˆ‡æ¢å’Œç¿»é˜…ï¼Œä¸æ–¹ä¾¿çš„åŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œ<code>jest</code> åªéœ€è¦åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸‹è¿›è¡Œå­¦ä¹ ç¼–å†™å³å¯ã€‚</p>
<p>å®‰è£…è¿‡ç¨‹ï¼Œåªéœ€è¦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vue add @vue/unit-jest</div></pre></td></tr></table></figure>
<p>ä¾¿å¯æå®š</p>
<p>ä¸¾ä¸ªä¾‹å­æ¼”ç¤ºä¸‹ï¼Œ</p>
<p>æ¯”å¦‚æˆ‘å†™äº†ä¸€ä¸ªè½®è¯¢å·¥å…·ç±»ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @class PollingAction</span></div><div class="line"><span class="comment"> * @param &#123;Function&#125;  callback[å›è°ƒå‡½æ•°]</span></div><div class="line"><span class="comment"> * @param &#123;Number&#125;  time[è½®è¯¢æ—¶é—´]</span></div><div class="line"><span class="comment"> * @param &#123;immediate&#125;  immediate[æ˜¯å¦ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°]</span></div><div class="line"><span class="comment"> * @description  é€šè¿‡ç»™å®šçš„TIMEè¿›è¡Œè½®è¯¢æ“ä½œ</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">PollingAction</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(callback, time = 1000, immediate = false) &#123;</div><div class="line">    <span class="comment">// æ‰§è¡ŒçŠ¶æ€</span></div><div class="line">    <span class="keyword">this</span>.running = <span class="literal">false</span>;</div><div class="line">    <span class="comment">// è½®è¯¢é—´éš”</span></div><div class="line">    <span class="keyword">this</span>.time = time;</div><div class="line">    <span class="comment">// æ˜¯å¦ç«‹å³æ‰§è¡Œ</span></div><div class="line">    <span class="keyword">this</span>.immediate = immediate;</div><div class="line">    <span class="comment">// callbackåˆ¤æ–­</span></div><div class="line">    <span class="keyword">if</span> (callback) &#123;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">"function"</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.callback = callback;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"å‚æ•°1 å¿…é¡»æ˜¯ä¸ªå‡½æ•°"</span>);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">this</span>.callback = <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// timeræ§åˆ¶</span></div><div class="line">    <span class="keyword">this</span>.timer = <span class="literal">null</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// æ‰§è¡Œè½®è¯¢</span></div><div class="line">  start() &#123;</div><div class="line">    <span class="comment">// æ˜¯å¦ç«‹å³æ‰§è¡Œ</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.immediate) &#123;</div><div class="line">      <span class="keyword">this</span>.callback &amp;&amp; <span class="keyword">this</span>.callback();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">this</span>.running = <span class="literal">true</span>;</div><div class="line">    <span class="keyword">const</span> onAction = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">this</span>.timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.running) &#123;</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">this</span>.callback &amp;&amp; <span class="keyword">this</span>.callback();</div><div class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</div><div class="line">            <span class="built_in">console</span>.log(error);</div><div class="line">            <span class="keyword">this</span>.cancel();</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">return</span> onAction();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">      &#125;, <span class="keyword">this</span>.time);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> onAction();</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// å–æ¶ˆè½®è¯¢</span></div><div class="line">  cancel() &#123;</div><div class="line">    <span class="keyword">this</span>.running = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">this</span>.timer &amp;&amp; clearTimeout(<span class="keyword">this</span>.timer);</div><div class="line">    <span class="keyword">this</span>.timer = <span class="literal">null</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸‹é¢è¦å¯¹å…¶è¿›è¡Œä¸€äº›æµ‹è¯•ç¼–å†™ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> PollingAction <span class="keyword">from</span> <span class="string">"@/utils/pollingAction"</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'æµ‹è¯• pollAction è½®è¯¢ç±»'</span>, () =&gt; &#123;</div><div class="line"></div><div class="line">  <span class="comment">// mock setTimeout</span></div><div class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> jest.useFakeTimers();</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  test(<span class="string">'æµ‹è¯•éç«‹å³æ‰§è¡Œè½®è¯¢'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> time = <span class="number">1000</span>;</div><div class="line">    <span class="keyword">const</span> callback = jest.fn();</div><div class="line">    <span class="keyword">const</span> po = <span class="keyword">new</span> PollingAction(callback, time, <span class="literal">false</span>);</div><div class="line"></div><div class="line">    <span class="comment">// è§¦å‘è½®è¯¢</span></div><div class="line">    po.start();</div><div class="line"></div><div class="line">    <span class="comment">// æ­¤åˆ»ä¸åº”è¯¥è§¦å‘å›è°ƒï¼Œ1000ms åæ‰è§¦å‘</span></div><div class="line">    expect(callback).not.toBeCalled();</div><div class="line"></div><div class="line">    <span class="comment">// æœ‰2ç§æ—¶é—´å¿«è¿›æ–¹æ³•</span></div><div class="line">    <span class="comment">// jest.advanceTimersByTime(1000);</span></div><div class="line">    jest.runOnlyPendingTimers();</div><div class="line"></div><div class="line">    expect(callback).toBeCalled();</div><div class="line">    expect(callback).toHaveBeenCalledTimes(<span class="number">1</span>);</div><div class="line">    expect(setTimeout).toHaveBeenLastCalledWith(expect.any(<span class="built_in">Function</span>), time);<span class="comment">// è®¾ç½®è§¦å‘æ—¶æœº</span></div><div class="line"></div><div class="line">    <span class="comment">// æ¶ˆè€—æ—¶é—´</span></div><div class="line">    jest.runOnlyPendingTimers();</div><div class="line">    expect(callback).toHaveBeenCalledTimes(<span class="number">2</span>); <span class="comment">// ç¬¬2æ¬¡è§¦å‘</span></div><div class="line">    expect(setTimeout).toHaveBeenLastCalledWith(expect.any(<span class="built_in">Function</span>), time);</div><div class="line"></div><div class="line">    <span class="comment">// å–æ¶ˆè½®è¯¢</span></div><div class="line">    po.cancel();</div><div class="line">    jest.runOnlyPendingTimers();</div><div class="line">    expect(callback).toHaveBeenCalledTimes(<span class="number">2</span>); <span class="comment">// po.cancel ç”Ÿæ•ˆï¼Œå›è°ƒä»ç„¶åªæ‰§è¡Œ 2 æ¬¡</span></div><div class="line"></div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  test(<span class="string">'æµ‹è¯•ç«‹å³æ‰§è¡Œè½®è¯¢'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> time = <span class="number">1000</span>;</div><div class="line">    <span class="keyword">const</span> callback = jest.fn();</div><div class="line">    <span class="keyword">const</span> po = <span class="keyword">new</span> PollingAction(callback, time, <span class="literal">true</span>);</div><div class="line"></div><div class="line">    po.start();</div><div class="line"></div><div class="line">    <span class="comment">// start ç«‹é©¬æ‰§è¡Œå›è°ƒ</span></div><div class="line">    expect(callback).toBeCalled();</div><div class="line"></div><div class="line">    jest.runOnlyPendingTimers();</div><div class="line"></div><div class="line">    expect(callback).toHaveBeenCalledTimes(<span class="number">2</span>);</div><div class="line">    expect(setTimeout).toHaveBeenLastCalledWith(expect.any(<span class="built_in">Function</span>), time);</div><div class="line"></div><div class="line">    po.cancel();</div><div class="line">    jest.runOnlyPendingTimers();</div><div class="line">    expect(callback).toHaveBeenCalledTimes(<span class="number">2</span>);</div><div class="line"></div><div class="line">  &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>é€šè¿‡æµ‹è¯•ï¼Œå¯ä»¥éªŒè¯è½®è¯¢ç±»å†™å¾—æœ‰æ²¡æœ‰æ¯›ç—…ï¼Œè¿™æ ·è™½ç„¶è¦å†™å¤šäº†äº›æµ‹è¯•ä»£ç ï¼Œä½†æ˜¯è¿™æ˜¯å€¼å¾—çš„ï¼Œè¿˜æœ‰ä¸€äº›é‡è¦çš„æ¨¡å—ä¹Ÿè¦è¦†ç›–å•å…ƒæµ‹è¯•ã€‚</p>
<h2 id="è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#è‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="è‡ªåŠ¨åŒ–éƒ¨ç½²"></a>è‡ªåŠ¨åŒ–éƒ¨ç½²</h2><p>æ‰‹åŠ¨æ‰“åŒ…éƒ¨ç½²æ˜¯ä¸€ä»¶éå¸¸ğŸ¤¢çš„äº‹æƒ…ï¼Œä¼šæµªè´¹æˆ‘ä»¬å¾ˆå¤šæ—¶é—´ï¼Œè¿™äº›è¿‡ç¨‹å®Œå…¨è¦äº¤ç»™æœºå™¨å»å¸®æˆ‘ä»¬å®Œæˆï¼Œæ‰€ä»¥å¿…é¡»è¦é‡‡ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚å› ä¸ºæˆ‘ä»¬åœ¨ <code>gitlab</code> ä¸‹è¿›è¡Œå¼€å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™è¾¹ç”¨ <code>gitlab-hooks+jenkins+docker</code> æ–¹å¼å®ç°è‡ªåŠ¨åŒ–æ‰“åŒ…éƒ¨ç½²</p>
<p>åŸºæœ¬æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7%E6%80%BB%E7%BB%93-%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B.png" alt="è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹"></p>
<p>å¦‚æœè¦ç»†è¯´çš„è¯ï¼Œå†…å®¹ä¼šå¾ˆå¤šï¼Œå®Œå…¨å¯ä»¥å¦å¼€ç¯‡åšå®¢æ¥å™è¿°äº†ğŸ˜‚ã€‚è¿˜æœ‰ä¸€äº›å…³äºvueæŠ€å·§æ–¹é¢çš„â€œå¹²è´§â€ï¼Œåœ¨æˆ‘çš„ <a href="http://shooterblog.site/2018/11/04/Vue%E5%AE%9E%E8%B7%B5%E5%B0%8F%E7%BB%93(%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0">Vue å®è·µå°ç»“</a>/) åšå®¢ä¸­ä¼šæœ‰è®²ï¼Œå¤§å®¶å¦‚æœ‰å…´è¶£å¯ä»¥å»è½¬è½¬ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»è¿‡åŠªåŠ›ï¼Œ100å¤šæ¬¡çš„commitï¼Œç»ˆäºå®Œæˆäº†ç³»ç»Ÿä¼˜åŒ–å’Œä»£ç è¿ç§»ã€‚æœ€åï¼Œè¿™ç¯‡æ–‡ç« æ¯”è¾ƒé•¿ï¼Œæ„Ÿè°¢æ‚¨èƒ½è¯»åˆ°è¿™é‡Œï¼Œå¦‚æœæ–‡ä¸­å­˜åœ¨ä»€ä¹ˆä¸è¶³ä¹‹å¤„ï¼Œæˆ–è€…æœ‰å€¼å¾—æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡å‡ºï¼ŒChat at anytime!</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Rao Jinwei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://shooterblog.site/2018/11/11/è®°ä¸€æ¬¡ç³»ç»Ÿå‰ç«¯åº•å±‚å‡çº§æ€»ç»“/">http://shooterblog.site/2018/11/11/è®°ä¸€æ¬¡ç³»ç»Ÿå‰ç«¯åº•å±‚å‡çº§æ€»ç»“/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA 3.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://shooterblog.site" target="_blank">Rao Jinwei's Blog</a>ï¼</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/é‡æ„/">é‡æ„</a><a class="post-meta__tags" href="/tags/vue/">vue</a></div><elif theme.sharejs && theme.sharejs.enable></elif></article><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/05/25/GraphQL + Apollo + Vue ç‰›åˆ€å°è¯•/"><i class="fa fa-chevron-left">  </i><span>GraphQL + Apollo + Vue ç‰›åˆ€å°è¯•</span></a></div><div class="next-post pull-right"><a href="/2018/11/04/Vueå®è·µå°ç»“(é•¿æœŸæ›´æ–°)/"><span>Vue å®è·µå°ç»“(é•¿æœŸæ›´æ–°)</span><i class="fa fa-chevron-right"></i></a></div></nav><elif theme.laibili && theme.laibili.enable></elif><elif theme.gitment && theme.gitment.enable></elif><elif theme.gitalk && theme.gitalk.enable></elif></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By Rao Jinwei</div><div class="framework-info"><span>é©±åŠ¨ - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.4.2"></script><script src="/js/fancybox.js?version=1.4.2"></script><script src="/js/sidebar.js?version=1.4.2"></script><script src="/js/copy.js?version=1.4.2"></script><script src="/js/fireworks.js?version=1.4.2"></script><script src="/js/transition.js?version=1.4.2"></script><script src="/js/scroll.js?version=1.4.2"></script><script src="/js/head.js?version=1.4.2"></script></body></html>