<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="记一次系统前端底层升级总结"><meta name="keywords" content="重构,vue"><meta name="author" content="Rao Jinwei,undefined"><meta name="copyright" content="Rao Jinwei"><title>记一次系统前端底层升级总结 | Rao Jinwei's Blog</title><link rel="shortcut icon" href="/sl.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.4.2"><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: undefined
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于这次升级"><span class="toc-number">2.</span> <span class="toc-text">关于这次升级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于vuecli3"><span class="toc-number">3.</span> <span class="toc-text">关于vuecli3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器布局组件重写"><span class="toc-number">4.</span> <span class="toc-text">容器布局组件重写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#系统菜单改为根据路由表信息进行渲染"><span class="toc-number">5.</span> <span class="toc-text">系统菜单改为根据路由表信息进行渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路由表按系统划分进行重构"><span class="toc-number">6.</span> <span class="toc-text">路由表按系统划分进行重构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#目录结构重新整理"><span class="toc-number">7.</span> <span class="toc-text">目录结构重新整理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pre-commit"><span class="toc-number">8.</span> <span class="toc-text">pre-commit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#首屏优化"><span class="toc-number">9.</span> <span class="toc-text">首屏优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#兼容IE11"><span class="toc-number">10.</span> <span class="toc-text">兼容IE11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动注册全局组件"><span class="toc-number">11.</span> <span class="toc-text">自动注册全局组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">12.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars1.githubusercontent.com/u/23609695?s=400&amp;u=d2db8f6efdee5add420addf7f89b916f7ef47ca7&amp;v=4"></div><div class="author-info__name text-center">Rao Jinwei</div><div class="author-info__description text-center">追寻生活的影子</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">14</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">15</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">9</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://pic1.win4000.com/wallpaper/7/59bb35a6c903f.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Rao Jinwei's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">记一次系统前端底层升级总结</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-11</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/vue/">vue</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近参与了一个比较大的类后台管理系统的前端开发(vue技术栈)，并负责了该系统的底层升级，升级过程期间，遇到了不少问题，在解决问题的过程中学到了很多，趁着今天双11没啥事做🙂，那么就花点时间总结下升级系统的过程吧</p>
<a id="more"></a>
<h2 id="关于这次升级"><a href="#关于这次升级" class="headerlink" title="关于这次升级"></a>关于这次升级</h2><p>听同事说，当时时间比较急，对<code>vuecli3</code>不太熟悉，就选了基于<code>vuecli2</code>进行快速开发。因为有<strong>6</strong>个系统，页面非常多，所以在底层代码的上没有太多的时间进行优化。在我参与进来之后，我收到了一些同事的反馈和还没有解决的问题，比如首屏加载慢，路由设计存在问题，刷新页面菜单无法高亮等等。跟开发的小伙伴们沟通一番之后，我决定用最新的<code>vuecli3</code>重新另起一个副本，把一些底层的逻辑重写，把现有的问题一起解决。</p>
<p>下面是关于这次升级的feature：</p>
<ul>
<li>底层基于vuecli3</li>
<li>基础容器布局组件重写</li>
<li>路由表按系统划分进行重构</li>
<li>系统菜单改为根据路由表信息进行渲染</li>
<li>目录结构重新整理，pre-commit代码规范约束</li>
<li>提供接口Mock以及Api从组件中抽离</li>
<li>首屏优化</li>
<li>兼容IE11</li>
</ul>
<p>👇开始分点进行总结</p>
<h2 id="关于vuecli3"><a href="#关于vuecli3" class="headerlink" title="关于vuecli3"></a>关于vuecli3</h2><p>在上两个月，vue官方推出了vuecli3的<code>release</code>版。跟以往熟悉的cli2相比，cli3生成的项目确实变了不少。首先官方开始推崇无<code>Eject</code>化，关于webpack的相关配置全部隐藏，只提供<code>vue.config.js</code>接口进行相关配置的更改。这样，对于不怎么需要更改webpack配置的开发者来说，可以把注意力都放在业务层上，无须过多关心底层插件的配置信息。但是对于要大量修改webpack配置的开发者来说，需要学习<code>webpack-chain</code>的使用，才能准确得更改webpack的配置信息。除此之外，vuecli3对一些生态和依赖都进行了全面的升级，比如<code>Bebel7</code>,<code>webpack</code>升级到了4.x，代码编译优化，打包速度都有了相关提升。</p>
<p>其实，对于我们这目前的项目来说，从cli2迁移到cli3的成本并不大，底层webpack的配置修改得并不多，cli2能配的cli3同样能配，只是配的方法稍有不同。上层的页面都可以无缝进行迁移。对于<strong>cli2版增加的webpack配置</strong>，有以下几项：</p>
<ul>
<li><code>sass-resources-loader</code>注入全局scss变量</li>
<li>生产环境剔除<code>console.log</code></li>
<li>打包文件出口路径修改</li>
</ul>
<p><code>cli3</code>实现以上几点的方法： </p>
<ul>
<li>注入全局scss变量的方式:</li>
</ul>
<p>在<code>vue.config.js</code>中增加：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  css: &#123;</div><div class="line">    loaderOptions: &#123;</div><div class="line">      <span class="comment">// 给 sass-loader 传递选项</span></div><div class="line">      sass: &#123;</div><div class="line">        data: <span class="string">`@import "@/styles/mixin.scss";`</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>生产环境剔除<code>console.log</code></li>
</ul>
<p>同样在<code>vue.config.js</code>中增加：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引入uglifyjs插件</span></div><div class="line"><span class="keyword">const</span> UglifyJsPlugin = <span class="built_in">require</span>(<span class="string">"uglifyjs-webpack-plugin"</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  configureWebpack: &#123;</div><div class="line">    optimization: &#123;</div><div class="line">      minimizer: [</div><div class="line">        <span class="keyword">new</span> UglifyJsPlugin(&#123;</div><div class="line">          uglifyOptions: &#123;</div><div class="line">            compress: &#123;</div><div class="line">              warnings: <span class="literal">false</span>,</div><div class="line">              drop_console: <span class="literal">true</span>,</div><div class="line">              drop_debugger: <span class="literal">true</span></div><div class="line">            &#125;</div><div class="line">          &#125;,</div><div class="line">          sourceMap: <span class="literal">true</span> <span class="comment">// 如果去除console.logd的话, sourceMap默认为false</span></div><div class="line">        &#125;)</div><div class="line">      ]</div><div class="line">    &#125;,</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>打包文件出口路径修改</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  baseUrl: process.env.NODE_ENV === <span class="string">"development"</span> ? <span class="string">"/"</span> : <span class="string">"./"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="容器布局组件重写"><a href="#容器布局组件重写" class="headerlink" title="容器布局组件重写"></a>容器布局组件重写</h2><p>关于系统的布局方式，我简单画了下：</p>
<p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/blog01.png" alt="Layout"></p>
<p>之前基于cli2的版本，是把<strong>系统内容</strong>用<code>&lt;router-view/&gt;</code>进行管理，蓝色圈中的地方又包了一层<code>&lt;router-view/&gt;</code>，外面的路由采用动态路由去管理： </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  name: <span class="string">"System"</span>,</div><div class="line">  path: <span class="string">"/System/:id"</span>,</div><div class="line">  props: <span class="literal">true</span>,</div><div class="line">  component: System</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对应系统页面的url<code>http://localhost:8080/#/System/0/FZBZDataview</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">id: 0 =&gt; 系统1</div><div class="line">id: 1 =&gt; 系统2</div><div class="line">id: 2 =&gt; 系统3</div><div class="line">...</div></pre></td></tr></table></figure>
<p>这种设计有个<strong>问题</strong>，就是在vue动态路由中，<code>/System/:id</code>中的<code>id</code>可以是任何值，如果不进行判断验证逻辑的话，<code>http://localhost:8080/#/System/xxx/FZBZDataview</code>都会跳转到该系统页面，<strong>并不能跳转到此时应该跳转到的404页面</strong></p>
<p>还有个小问题，就是在菜单高亮的处理上，由于在上面设计的基础上，额外加了很多状态进行管理，导致实现菜单高亮方式过于复杂了，于是我顺便把实现菜单高亮的方式一并重写了。</p>
<p>下面先来聊聊我对于容器组件的设计思路： </p>
<p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/blog02.png" alt="设计思路"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">├── Layout</div><div class="line">│   ├── Header                 # 头部组件</div><div class="line">│   ├── SubList                # 左侧菜单组件</div><div class="line">│   └── Layout.vue             # Layout组件</div><div class="line">|   └── index.js</div></pre></td></tr></table></figure>
<blockquote>
<p>把容器组件抽象出来，对于以后需求和UI的变动，也可以灵活应变了</p>
</blockquote>
<ul>
<li>先来解决菜单高亮</li>
</ul>
<p>菜单高亮用<code>$route</code>来进行处理的话，就比较简洁了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 组件computed</span></div><div class="line">computed: &#123;</div><div class="line">  currentPreRouteName() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$route.matched[<span class="number">0</span>].name;</div><div class="line">  &#125;</div><div class="line">&#125;,</div><div class="line">methods: &#123;</div><div class="line">  <span class="comment">// 高亮list-item</span></div><div class="line">  computedClass(item) &#123;</div><div class="line">    <span class="keyword">const</span> className = [<span class="string">"list-item"</span>];</div><div class="line">    <span class="keyword">const</span> &#123; name &#125; = item;</div><div class="line">    <span class="keyword">const</span> &#123; currentPreRouteName &#125; = <span class="keyword">this</span>;</div><div class="line">    <span class="keyword">if</span> (currentPreRouteName === name) &#123;</div><div class="line">      className.push(<span class="string">"active"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> className;</div><div class="line">  &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在模板上的处理,</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"app-nav-list"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">:class</span>=<span class="string">"computedClass(navItem)"</span> <span class="attr">v-for</span>=<span class="string">"navItem in navList"</span> <span class="attr">:key</span>=<span class="string">"navItem.name"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"navItem.path"</span>&gt;</span></div><div class="line">      &#123;&#123;navItem.meta.navTitle&#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p>换成计算<code>$route</code>的<code>path</code>进行管理，比起之前的版本，不需要增加额外的状态，不需要watch，也解决了之前刷新页面无法自动高亮的问题(之前为什么不能高亮，具体原因我还没仔细研究，额外加的状态太多绕得比较晕😂)</p>
<ul>
<li>解决无法跳转404页面</li>
</ul>
<p>之前不能跳转到404页面的原因主要在之前用了动态路由去渲染系统页面，没有加逻辑处理拦截跳转到404。对于这种情况，我采取的解决方案是取消用动态路由去管理，改成匹配对应路由渲染对应的系统</p>
<p>举个🌰：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  path: <span class="string">"/FZBZ"</span>,</div><div class="line">  name: <span class="string">"FZBZ"</span>,</div><div class="line">  meta: &#123;</div><div class="line">    navTitle: <span class="string">"系统一"</span>,</div><div class="line">    icon: <span class="string">"icon-fzbz"</span></div><div class="line">  &#125;,</div><div class="line">  redirect: <span class="string">"/FZBZ/BaseDateHandle"</span>,</div><div class="line">  component: Layout,</div><div class="line">  children: [</div><div class="line">    &#123;</div><div class="line">      path: <span class="string">"BaseDateHandle"</span>,</div><div class="line">      name: <span class="string">"BaseDateHandle"</span>,</div><div class="line">      meta: &#123;</div><div class="line">        navTitle: <span class="string">"基期数据处理"</span>,</div><div class="line">        icon: <span class="string">"icon-shujuchanpinliulan"</span></div><div class="line">      &#125;,</div><div class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span></div><div class="line">        <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "BaseDateHandle" */</span> <span class="string">"FZBZ/BaseDateHandle"</span>)</div><div class="line">    &#125;,</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对应路由路径便是<code>http://localhost:9096/#/FZBZ/BaseDateHandle</code>，少了一层router-view，url也简洁了许多。</p>
<p>加个404跳转：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 没匹配到的路径都跳转到404页面</span></div><div class="line">&#123;</div><div class="line">  path: <span class="string">"*"</span>,</div><div class="line">  name: <span class="string">"404Page"</span>,</div><div class="line">  component: error404Page</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="系统菜单改为根据路由表信息进行渲染"><a href="#系统菜单改为根据路由表信息进行渲染" class="headerlink" title="系统菜单改为根据路由表信息进行渲染"></a>系统菜单改为根据路由表信息进行渲染</h2><p>之前系统菜单是请求本地自定义json去渲染的，这种方式我认为和路由表不能形成很好的映射，未来如果接入权限的话也很不方便进行控制，所以我统一改成读取路由表信息进行渲染</p>
<p>我写了几个工具函数，根据路由表去过滤路由信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">"@/router/routes"</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @param &#123;Object&#125; item</span></div><div class="line"><span class="comment"> * @description 判断一个对象中是否存在children</span></div><div class="line"><span class="comment"> * @returns Boolean</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> hasChild = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> item.children &amp;&amp; item.children.length !== <span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @param &#123;Array&#125; routes 路由表</span></div><div class="line"><span class="comment"> * @description 根据路由表获取NavList</span></div><div class="line"><span class="comment"> * @returns &#123;Array&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> getNavList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> navList = routes</div><div class="line">    .filter(<span class="function"><span class="params">item</span> =&gt;</span> item.meta &amp;&amp; item.meta.navTitle)</div><div class="line">    .map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">if</span> (!hasChild(item)) &#123;</div><div class="line">        <span class="comment">// path置空，router-link就可以阻止该导航</span></div><div class="line">        item.path = <span class="string">""</span>;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> item;</div><div class="line">    &#125;);</div><div class="line">  <span class="keyword">return</span> navList;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @param &#123;Object&#125; currentRoute $route</span></div><div class="line"><span class="comment"> * @description 根据当前页面路由进行匹配路由表，获取二级路由表</span></div><div class="line"><span class="comment"> * @returns &#123;Array&#125; subNavList</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSubNavList = <span class="function"><span class="params">currentRoute</span> =&gt;</span> &#123;</div><div class="line">  <span class="comment">// 先获取一级路由名</span></div><div class="line">  <span class="keyword">const</span> preRouteName = currentRoute.matched[<span class="number">0</span>].name;</div><div class="line">  <span class="keyword">const</span> len = routes.length;</div><div class="line">  <span class="comment">// 从路由表里面找到对应的二级菜单</span></div><div class="line">  <span class="keyword">let</span> SubNavList = [];</div><div class="line">  <span class="keyword">let</span> i = <span class="number">-1</span>;</div><div class="line">  <span class="keyword">while</span> (++i &lt; len) &#123;</div><div class="line">    <span class="keyword">if</span> (preRouteName === routes[i].name) &#123;</div><div class="line">      SubNavList = routes[i].children;</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> SubNavList;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>一个是获取系统菜单，一个是根据系统名去获取对应的二级子菜单信息</p>
<p>Portal页和Layout页皆由该方式进行渲染</p>
<h2 id="路由表按系统划分进行重构"><a href="#路由表按系统划分进行重构" class="headerlink" title="路由表按系统划分进行重构"></a>路由表按系统划分进行重构</h2><p>因为有6个系统，每个系统又有几十个页面，这样统一放在一个js里面，会显得无比笨重，也很容易改错里面的路由信息，所以，针对这种情况，我改成按系统名划分路由表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">├── router                      # 路由表管理</div><div class="line">│   └── routes</div><div class="line">│       ├── fzbz.js             </div><div class="line">│       ├── fzsc.js             </div><div class="line">│       ├── ghss.js             </div><div class="line">│       ├── jcyj.js             </div><div class="line">│       ├── zbmx.js             </div><div class="line">│       └── zxpg.js</div></pre></td></tr></table></figure>
<p><code>index.js</code>里面注册路由：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// nav-list按照挂载路由顺序渲染</span></div><div class="line"><span class="keyword">import</span> fzbz <span class="keyword">from</span> <span class="string">"./fzbz"</span>;</div><div class="line"><span class="keyword">import</span> fzsc <span class="keyword">from</span> <span class="string">"./fzsc"</span>;</div><div class="line"><span class="keyword">import</span> ghss <span class="keyword">from</span> <span class="string">"./ghss"</span>;</div><div class="line"><span class="keyword">import</span> jcyj <span class="keyword">from</span> <span class="string">"./jcyj"</span>;</div><div class="line"><span class="keyword">import</span> zxpg <span class="keyword">from</span> <span class="string">"./zxpg"</span>;</div><div class="line"><span class="keyword">import</span> zbmx <span class="keyword">from</span> <span class="string">"./zbmx"</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</div><div class="line">  ...,</div><div class="line">  &#123;</div><div class="line">    ...fzbz</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...fzsc</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...ghss</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...jcyj</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...zxpg</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    ...zbmx</div><div class="line">  &#125;</div><div class="line">];</div></pre></td></tr></table></figure>
<p>这样的话，对新加进来的开发人员也会非常友好，一眼就能知道该去哪里配置路由表啦😁</p>
<h2 id="目录结构重新整理"><a href="#目录结构重新整理" class="headerlink" title="目录结构重新整理"></a>目录结构重新整理</h2><p>之前的<code>src</code>目录结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">├── src</div><div class="line">│   ├── components                  # 页面和页面组件</div><div class="line">│   ├── App.vue                     # Vue根组件</div><div class="line">│   ├── main.js                     # 项目入口文件</div><div class="line">│   ├── router                      # 路由</div><div class="line">│   ├── store                       # vuex</div><div class="line">│   ├── style                       # 全局css</div><div class="line">│   ├── utils                       # 工具函数</div><div class="line">│   ├── registerComponent           # 注册全局组件</div></pre></td></tr></table></figure>
<p>整理成👇：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── src</div><div class="line">│   ├── main.js                     # 项目入口文件</div><div class="line">│   ├── App.vue                     # Vue根组件</div><div class="line">│   ├── Layout                      # 容器布局组件</div><div class="line">│   ├── api                         # 后端api统一管理</div><div class="line">│   ├── assets                      # 静态文件</div><div class="line">│   ├── components                  # 通用组件</div><div class="line">│   ├── icon                        # icon</div><div class="line">│   ├── mock                        # mockjs</div><div class="line">│   ├── plugins                     # 插件管理</div><div class="line">│   ├── register                    # 统一注册echarts、全局组件、polyfill</div><div class="line">│   ├── router                      # 路由表管理</div><div class="line">│   │   └── routes                  # 系统路由表</div><div class="line">│   ├── store                       # vuex</div><div class="line">│   ├── styles                      # 全局scss变量、全局样式</div><div class="line">│   ├── utils                       # 通用工具函数</div><div class="line">│   └── views                       # 页面</div><div class="line">└── vue.config.js                   # 工程配置文件</div></pre></td></tr></table></figure>
<h2 id="pre-commit"><a href="#pre-commit" class="headerlink" title="pre-commit"></a>pre-commit</h2><p>pre-commit作用好处不用多说，git commit前执行lint</p>
<p>安装<code>husky</code>，<code>lint-stage</code>插件，package.json中配置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="string">"lint-staged"</span>: &#123;</div><div class="line">  <span class="string">"src/**/*.&#123;vue,js&#125;"</span>: [</div><div class="line">    <span class="string">"yarn lint"</span>,</div><div class="line">    <span class="string">"git add"</span></div><div class="line">  ],</div><div class="line">  <span class="string">"src/**/*.&#123;json,md,css,scss&#125;"</span>: [</div><div class="line">    <span class="string">"prettier --write"</span>,</div><div class="line">    <span class="string">"git add"</span></div><div class="line">  ]</div><div class="line">&#125;,</div><div class="line"><span class="string">"husky"</span>: &#123;</div><div class="line">  <span class="string">"hooks"</span>: &#123;</div><div class="line">    <span class="string">"pre-commit"</span>: <span class="string">"lint-staged"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="首屏优化"><a href="#首屏优化" class="headerlink" title="首屏优化"></a>首屏优化</h2><p>之前听说由于静态资源比较多，首屏加载比较慢。我build了下发现，<code>app.js</code>居然高达<strong>17m</strong>！这样加载首屏肯定慢了！我追踪了下发现，都是一些地图json文件太大导致的，主要是下面这些代码产生的问题：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">echarts.registerMap(<span class="string">"china"</span>, <span class="built_in">require</span>(<span class="string">"../static/map/china.json"</span>);</div><div class="line">echarts.registerMap(<span class="string">"guangzhou"</span>,<span class="built_in">require</span>(<span class="string">"../static/map/cities/guangzhou.json"</span>));</div><div class="line">echarts.registerMap(<span class="string">"beijing"</span>, <span class="built_in">require</span>(<span class="string">"../static/map/cities/beijing.json"</span>));</div><div class="line">echarts.registerMap(<span class="string">"shenyang"</span>, <span class="built_in">require</span>(<span class="string">"../static/map/cities/shenyang.json"</span>));</div></pre></td></tr></table></figure>
<p><code>require</code>是同步引入，webpack会把这些庞大的<code>json</code>全部同步打包到<code>app.js</code>里面，所以会非常大。后来凡童鞋提供了一个思路，问我能不能用异步加载，这样会不会体积小一点？答案是肯定的，把上面代码改成读取本地json，读取完后再进行注册：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 采用异步的方式注册json地图</span></div><div class="line"><span class="keyword">const</span> jsonMap = &#123;</div><div class="line">  china: <span class="string">"static/map/china.json"</span>,</div><div class="line">  chinacity: <span class="string">"static/map/china-cities.json"</span>,</div><div class="line">  cj_citylevel: <span class="string">"static/map/changjiang_city_level.json"</span>,</div><div class="line">  cj_up_mid_down: <span class="string">"static/map/changjiang_up_mid_down.json"</span>,</div><div class="line">  cj_provincial: <span class="string">"static/map/changjiang_provincial.json"</span>,</div><div class="line">  ningxiacity: <span class="string">"static/map/Ningxia.json"</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> jsonMap) &#123;</div><div class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(jsonMap, i))</div><div class="line">    axios.get(jsonMap[i]).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</div><div class="line">      echarts.registerMap(i, res.data);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>经测试，打包后的体积明显减少！但是，还有优化空间，比如有些系统的路由组件不是异步组件，我们可以全部改成组件懒加载</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  ...,</div><div class="line">  component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "BaseDateHandle" */</span> <span class="string">"FZBZ/BaseDateHandle"</span>)&#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再打包，<code>app.js</code>已经减少到<code>180k</code>左右了，从<code>17m</code>到<code>180k</code>，速度提升可以说是非常明显了。</p>
<p>但是<code>vendor.js</code>还是高达<code>2m</code>，主要原因用的是第三方的包太多，<code>iview</code>也没改成按需加载，<code>echarts</code>也是，以后会针对这些包进行相关优化。</p>
<p>此外，之前打包的代码是没有配置<code>gzip</code>的，开启<code>gzip</code>速度会更快，为了实现这个功能，我使用了webpack的一个插件，加点配置就可实现</p>
<p><code>vue.config.js</code>增加配置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> CompressionPlugin = <span class="built_in">require</span>(<span class="string">"compression-webpack-plugin"</span>);</div><div class="line"><span class="keyword">const</span> productionGzipExtensions = [<span class="string">"js"</span>, <span class="string">"css"</span>];</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  configureWebpack: &#123;</div><div class="line">    <span class="comment">// gzip</span></div><div class="line">    plugins: process.env.NODE_ENV === <span class="string">"production"</span> ? [</div><div class="line">      <span class="keyword">new</span> CompressionPlugin(&#123;</div><div class="line">        filename: <span class="string">"[path].gz[query]"</span>,</div><div class="line">        algorithm: <span class="string">"gzip"</span>,</div><div class="line">        test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"\\.("</span> + productionGzipExtensions.join(<span class="string">"|"</span>) + <span class="string">")$"</span>),</div><div class="line">        threshold: <span class="number">10240</span>,</div><div class="line">        minRatio: <span class="number">0.8</span></div><div class="line">      &#125;)</div><div class="line">    ] : []</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>首屏优化，永无止境！</p>
<h2 id="兼容IE11"><a href="#兼容IE11" class="headerlink" title="兼容IE11"></a>兼容IE11</h2><p>这个系统需要兼容ie11，现在cli3已经默认帮我们引入<code>Promise</code>的<code>Polyfill</code>，所以不需要我们额外配置。目前的问题，其中一个就是用的第三方库<code>vue-echarts-v3</code>是用<code>es6</code>编写的，由于<code>vuecli3</code>底层的<code>webpack</code>配置中，<code>node_modules</code>下的包是默认不走<code>Babel</code>编译的，我们在<code>npm</code>装的包，作者没有帮我们去编译，而是希望我们手动去配置编译<a href="https://github.com/xlsdg/vue-echarts-v3#usage" target="_blank" rel="external">vue-echarts-v3使用需求</a></p>
<p>增加<code>vue.config.js</code>配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  transpileDependencies: [<span class="string">"node_modules/vue-echarts-v3/src"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>👆问题解决</p>
<p>but…</p>
<p>👇还有个问题</p>
<p>凡童鞋反应有的页面在ie中打不开，经追踪，凡是用到了<code>iview</code>的<code>Tabs</code>组件都打不开，通过报错信息，查到<code>Tabs</code>组件里用到了数组<code>findIndex</code>这个比较新的api，这个api在所有的ie中都不支持。因为<code>iview</code>也是<code>node_modules</code>下的，同样也无法走Babel编译，我采取的解决方法是，手动引用polyfill，不用上面的方案了，因为<code>iview</code>生产版已经被<code>Babel</code>编译过了，只不过没有用到<code>babel-polyfill</code>。</p>
<p>我建了个目录，专门管理<code>polyfill</code>：</p>
<p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/blog03.png" alt="polyfill"></p>
<p>后来，查阅<code>vuecli3</code>的<a href="https://cli.vuejs.org/zh/guide/browser-compatibility.html#polyfill" target="_blank" rel="external">polyfill选项</a>，发现好像可以通过配置实现相关api的<code>polyfill</code>，这种也是一种不错的解决方案。</p>
<h2 id="自动注册全局组件"><a href="#自动注册全局组件" class="headerlink" title="自动注册全局组件"></a>自动注册全局组件</h2><p>系统中，我们根据UI设计的组件，开发了许多全局组件，我发现每一次开发完成，都要去<code>registerComponent.js</code>中进行手动注册，感觉比较麻烦，于是我决定用自动注册组件方法进行全局注册，一劳永逸：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span>;</div><div class="line"></div><div class="line"><span class="comment">// 检索目录下的模块</span></div><div class="line"><span class="comment">// rrequire.context 会返回一个函数</span></div><div class="line"><span class="keyword">const</span> req = <span class="built_in">require</span>.context(<span class="string">"."</span>, <span class="literal">true</span>, /\.vue$/);</div><div class="line"></div><div class="line">req.keys().forEach(<span class="function"><span class="params">fileName</span> =&gt;</span> &#123;</div><div class="line">  <span class="comment">// require模块</span></div><div class="line">  <span class="keyword">const</span> componentConfig = req(fileName);</div><div class="line">  <span class="keyword">const</span> name =</div><div class="line">    fileName.name || fileName.replace(<span class="regexp">/^\.\/.*\//</span>, <span class="string">""</span>).replace(<span class="regexp">/\.vue$/</span>, <span class="string">""</span>);</div><div class="line">  Vue.component(name, componentConfig.default || componentConfig);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>然后在<code>registerComponent.js</code>中加入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 全局组件注册</span></div><div class="line"><span class="keyword">import</span> <span class="string">"@/components"</span>;</div></pre></td></tr></table></figure>
<p>这样，在<code>components</code>文件下的所有组件都视为全局组件了</p>
<p><img src="https://img-1257816861.cos.ap-guangzhou.myqcloud.com/A966FB85-843C-475C-B830-1A1A736BB658.png" alt="全局组件"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>经过和凡童鞋这两周的努力，70多次的commit，终于完成了系统优化和代码迁移。由于经验还不是很多，这么大的管理系统也是第一次参与开发，很多架构方面的知识仍然比较欠缺，只能在往后的学习和实践中不断地进行重构和改造。最后，这篇文章比较长，感谢您能读到这里，如果文中存在什么不足之处，或者有值得改进的地方，欢迎指出，Chat at anytime!</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Rao Jinwei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://shooterblog.site/2018/11/11/记一次系统前端底层升级总结/">http://shooterblog.site/2018/11/11/记一次系统前端底层升级总结/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明来自 <a href="http://shooterblog.site" target="_blank">Rao Jinwei's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/重构/">重构</a><a class="post-meta__tags" href="/tags/vue/">vue</a></div><elif theme.sharejs && theme.sharejs.enable></elif></article><nav id="pagination"><div class="next-post pull-right"><a href="/2018/11/04/Vue实践小结(长期更新)/"><span>Vue 实践小结(长期更新)</span><i class="fa fa-chevron-right"></i></a></div></nav><elif theme.laibili && theme.laibili.enable></elif><elif theme.gitment && theme.gitment.enable></elif><elif theme.gitalk && theme.gitalk.enable></elif></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By Rao Jinwei</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.4.2"></script><script src="/js/fancybox.js?version=1.4.2"></script><script src="/js/sidebar.js?version=1.4.2"></script><script src="/js/copy.js?version=1.4.2"></script><script src="/js/fireworks.js?version=1.4.2"></script><script src="/js/transition.js?version=1.4.2"></script><script src="/js/scroll.js?version=1.4.2"></script><script src="/js/head.js?version=1.4.2"></script></body></html>